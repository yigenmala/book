(function(){var w=window,y=document,C=window.location,b=window.NTKF||{},f=b.$,j=b.A,n=b.B,x=b.C,D=b.D,A=b.E,E=b.H,r=b.J,i=b.Lang,p=b.S,h=b.debug,F=b.require;b.String('<a href="%1" onclick="%2" style="margin:0;padding:0;border:0;font:normal 12px/160% Arial,SimSun;color:#0a8cd2;text-decoration:none;">').sprintf("javascript:void(0);","NTKF.chatManage.get('{settingid}').reconnect(this);");var G=b.String('<a href="%1" onclick="%2" style="margin:0;padding:0;border:0;font:normal 12px/160% Arial,SimSun;color:#0a8cd2;text-decoration:none;">').sprintf("javascript:void(0);",
"NTKF.chatManage.get('{settingid}').switchUI(1, 5);return false;");"function"!=typeof b.extend?alert(b.String(i.load_file).sprintf("core.js")):"object"!=typeof b.Chat&&(b.imagesResources=j.extend({url_image:"",url_chat_image:"",url_mobile_image:"",resources:[]},b.imagesResources),b.extend({FORM:{createInput:function(a,e){var c=[],d,g,f,z=j.extend({id:"",rowspan:0,style:""},e);required='<span class="ntkf-text-red" style="margin:0;padding:2px 5px 2px 0;border:0;float:none;font:normal 12px/160% Arial,SimSun;color:#f00;">'+
i.message_no_null+"</span>";for(var h=0;h<a.length;h++){d=j.extend({titlewidth:"80px",inputwidth:"auto",input:{width:"90%",height:"auto"}},a[h]);8<p.len(d.title)||d.multipart||/radio|checkbox/.test(d.type)?(d.multipart=!0,c.push(['<tr style="margin:0;padding:0;border:0;"><td colspan="2" style="margin:0;padding:0;border:0;text-align:left;vertical-align:top;font:normal 12px/28px Arial,SimSun;color:#333;">','<div style="margin:5px 10px 5px 10px;padding:0;border:0;float:none;text-align:left;color:#5a5a5a;font:normal 12px/160% Arial,SimSun;">'+
d.title+"\uff1a"+(!0==d.required?required:"")+"</div>","</td></tr>",'<tr style="margin:0;padding:0;border:0;"><td style="margin:0;padding:0 5px 0 0;border:0;text-align:right;vertical-align:top;font:normal 12px/28px Arial,SimSun;color:#333;width:'+d.titlewidth+';"></td><td style="text-align:left;margin:0;padding:0;border:0;font:normal 12px/160% Arial,SimSun;width:'+d.inputwidth+';">'].join(""))):c.push('<tr style="margin:0;padding:0;border:0;"><td style="margin:0;padding:0 5px 0 0;border:0;text-align:right;vertical-align:top;font:normal 12px/28px Arial,SimSun;color:#333;width:'+
d.titlewidth+';"><div style="margin:4px 0 0 0;padding:0;border:0;float:none;text-align:right;color:#5a5a5a;font:normal 12px/160% Arial,SimSun;">'+(!0==d.required?required:"")+d.title+'\uff1a</div></td><td style="text-align:left;margin:0;padding:0;border:0;font:normal 12px/28px Arial,SimSun;width:'+d.inputwidth+';">');switch(d.type){case "select":c.push('<select ntkf_index="'+h+'" name="'+d.name+'" style="border:1px solid #ccc;height:24px;text-align:left;color:#333;margin:0 0 4px;padding:0;font:normal 12px/20px Arial,Sium;width:'+
d.input.width+';">');c.push('<option value="" style="margin:0;padding:0;border:0;font:normal 12px/160% Arial,SimSun;color:#ccc;text-align:left;">'+d.defaultText+"</option>");for(var m=0;m<d.options.length;m++)g=d.options[m],g="string"==typeof g?{text:g,value:g}:g,c.push('<option value="'+g.value+'" style="margin:0;padding:0;border:0;font:normal 12px/160% Arial,SimSun;color:#333;text-align:left;">'+g.text+"</option>");c.push("</select>");break;case "radio":c.push('<ul style="list-style:none;margin:0;padding:0;">');
for(var m=0,k;m<d.options.length;m++)g=d.options[m],g="string"==typeof g?{text:g,value:g}:g,k=d.name+"_"+m,f=d.defaultText==g.value?" checked":"",c.push('<li style="list-style:none;margin:0;padding:0 2px 0 0;border:0;width:auto;float:left;"><input type="radio" name="'+d.name+'"id="'+k+'" value="'+g.value+'" _custom_text="'+g.text+'" style="margin:0;padding:0;border:0;font:normal 12px/160% Arial,SimSun;color:#333;text-align:left;width:auto;"'+f+' /> <label for="'+k+'">'+g.text+"</label></li>");c.push('<li style="list-style:none;margin:0;padding:0;border:0;line-height:0px;font-size:0px;clear:both;"></li>');
c.push("</ul>");break;case "checkbox":c.push('<ul style="list-style:none;margin:0;padding:0;">');for(m=0;m<d.options.length;m++)g=d.options[m],g="string"==typeof g?{text:g,value:g}:g,k=d.name+"_"+m,f=d.defaultText==g.value?" checked":"",c.push('<li style="list-style:none;margin:0;padding:0 2px 0 0;border:0;width:auto;float:left;"><input type="checkbox" name="'+d.name+'" id="'+k+'" value="'+g.value+'" _custom_text="'+g.text+'" style="margin:0;padding:0;border:0;font:normal 12px/160% Arial,SimSun;color:#333;text-align:left;"'+
f+' /> <label for="'+k+'">'+g.text+"</label></li>");c.push('<li style="list-style:none;margin:0;padding:0;border:0;line-height:0px;font-size:0px;clear:both;"></li>');c.push("</ul>");break;case "textarea":c.push('<textarea ntkf_index="'+h+'" name="'+d.name+'" style="margin:0;padding:0;border:1px solid #ccc;color:#ccc;font:normal 12px/160% Arial,SimSun;text-align:left;width:'+d.input.width+";height:"+d.input.height+';">'+d.defaultText+"</textarea>");break;default:c.push('<input ntkf_index="'+h+'" ntkf_index="'+
h+'" type="text" name="'+d.name+'" value="'+d.defaultText+'" maxlength="32" style="border:1px solid #ccc;height:24px;width:'+d.input.width+';margin:0 0 4px;padding:0;text-align:left;color:#ccc;font:normal 12px/20px Arial,Sium;"'),"phone"==d.verification&&c.push(" onblur=\"this.value=this.value.replace(/[^0-9-]+/, '');\" onkeyup=\"this.value=this.value.replace(/[^0-9-]+/, '');\""),c.push(" />")}d.messageid&&c.push('<div id="'+d.messageid+'" class="NTKF-NEWS-DIV" style="display:none;font:12px/160% Arial,SimSun;color:#EF7208; margin:0px;padding:0 0 0 16px;text-align:left;background:url('+
b.imagesResources.url_chat_image+') no-repeat -50px -16px;"></div>');c.push("</td>");z.style&&0==h&&c.push('<td id="'+z.id+'" rowspan="'+z.rowspan+'" style="'+z.style+'"></td></tr>')}return c.join("")},bindFormEvent:function(a,b){f("input[type=text], textarea",b).bind("focus",function(b,e){var g=f(e).css({color:"#333","border-color":"#666"}),l=g.attr("ntkf_index")||0;a[l].defaultText==g.value()&&g.value("")}).bind("blur",function(b,e){var g=f(e).css("border-color","#ccc"),l=g.attr("ntkf_index")||
0,l=a[l].defaultText;""==g.value()&&g.value(l);(""==g.value()||g.value()==l)&&g.css("color","#ccc")})},verificationForm:function(a,e,c){for(var d,g,l=[],h,i=/\d{6,}/i,j=/^[a-zA-Z0-9\._-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/i,k=0;k<a.length;k++){switch(a[k].type){case "checkbox":value=[];d=f("input[name="+a[k].name+"]",c);g=f("input[name="+a[k].name+"][checked]",c);for(h=0;h<g.length;h++)value.push({value:g.get(h).value,text:f(g.get(h)).attr("_custom_text")});break;case "radio":d=f("input[name="+a[k].name+
"]",c);g=f("input[name="+a[k].name+"][checked]",c);value={value:g.value()||"",text:g.attr("_custom_text")};break;case "select":d=f("select[name="+a[k].name+"]",c);value=f("option[selected!='']",d).value()||"";break;case "textarea":d=f("textarea[name="+a[k].name+"]",c);a[k].defaultText&&a[k].defaultText==d.value()?(value="",d.value("")):value=d.value();break;default:d=f("input[name="+a[k].name+"]",c),a[k].defaultText&&a[k].defaultText==d.value()?(value="",d.value("")):value=d.value()}g="string"==typeof value?
""==value||!value.length:b.isArray(value)?0==value.length?!0:!1:""==value.value?!0:!1;h=a[k].messageid&&a[k].message?!0:!1;if(a[k].required&&g){h&&a[k].message[0]?(f("#"+a[k].messageid,c).html(a[k].message[0]).show(!0),d.first().focus()):/radio|checkbox/.test(a[k].type)?f(d.first().parentNode,c).css("color","#f00"):d.css("border-color","#f00").first().focus();return}if("phone"==a[k].verification&&!g&&!i.test(value)){h&&a[k].message[1]?(f("#"+a[k].messageid,c).html(a[k].message[1]).show(!0),d.first().focus()):
d.css("border-color","#f00").first().focus();return}if("email"==a[k].verification&&!g&&!j.test(value)){h&&a[k].message[1]?(f("#"+a[k].messageid,c).html(a[k].message[1]).show(!0),d.first().focus()):d.css("border-color","#f00").first().focus();return}if(a[k].min&&!g&&b.S.len(value)<a[k].min){h&&a[k].message[1]?(f("#"+a[k].messageid,c).html(a[k].message[1]).show(!0),d.first().focus()):d.css("border-color","#f00").first().focus();return}if(a[k].max&&!g&&b.S.len(value)>a[k].max){h&&a[k].message[2]?(f("#"+
a[k].messageid,c).html(a[k].message[2]).show(!0),d.first().focus()):d.css("border-color","#f00").first().focus();return}h?f("#"+a[k].messageid,c).hide(!0):/radio|checkbox/.test(a[k].type)?f(d.first().parentNode,c).css("color","#333"):d.css("border-color","#DBD8D1");g||l.push({name:a[k].name,title:a[k].title,value:value})}"function"==typeof e&&e(l)}}}),b.captureImage={id:null,element:null,divElement:null,method:null,loaded:!1,callback:null,fnError:null,timeID:null,initialize:function(a,e){this.method=
window;this.callback=a||new Function;this.fnError=e||new Function;this.id=this.id||"captureimage-"+b.randomChar();this.element=f("#"+this.id);this.divElement=f("#div-"+this.id);this.element&&this.element.length?this.cutScreen():this.create();return this.element},create:function(){var a=this,b;b=['<object name="'+this.id+'" id="'+this.id+'" type="application/x-ntalkercapimage" width="1" height="1" >','<param name="onload" value="pluginLoaded" /><param name="onaddfile" value="addfile" /><param name="onRetdata" value="onRetdata" /></object>'].join("");
this.divElement.length||(this.divElement=f({id:"div"+this.id,style:"position:absolute;z-index:9996;top:-200px;"}));this.method.pluginLoaded=function(){a.loaded=!0;clearTimeout(a.timeID);a.timeID=null;a.cutScreen();h.Log("capture image plugin Loaded!")};this.method.onRetdata=function(a){a||h.Log("Please install microsoft .Net framework",2)};this.method.addfile=function(b){try{a.cutScreenComplete(r.parseJSON(b))}catch(e){h.Log(e,3)}};this.divElement.html(b);this.element=f("#"+this.id);this.timeID=setTimeout(function(){clearTimeout(a.timeID);
a.timeID=null;a.verification()},5E3)},verification:function(){this.loaded?this.cutScreen():this.fnError(!1)},cutScreen:function(){if(!this.loaded)return this.fnError(!1),!1;if(!this.element.first()||!this.element.first().cutScreen)return!1;this.element.first().cutScreen("100","0");return!0},cutScreenComplete:function(a){this.callback&&this.callback(a)}},b.Chat=b.Class.create(),b.Chat.prototype={id:"",element:null,Flash:null,Flash_File:null,Flash_Image:null,baseColor:"#9BC942",hslColorDifference:null,
config:{},style:null,callback:null,dest:{},skin:{},settingid:"",selected:!0,connected:!1,isreconnect:!1,connect_status:"WAIT",first:!0,indexUI:0,sendNum:0,sendNumEnable:2,submitRating:!1,minChatMessageCount:0,reconnectCount:0,enable:!0,enableButtons:[],inputMaxByte:0,displayedMessage:null,__jdata:null,JetLag:0,waitTime:0,waitTimer:null,callMethod:null,globalTimestamp:0,hasSendAbnormal:null,showMaxNumber:50,entityList:{";":"&#59;","<":"&lt;","\uff1c":"&lt;",">":"&gt;","\uff1e":"&gt;","&":"&amp;","\uff06":"&amp;",
"\u00a9":"&copy;","\u00ae":"&reg;",'"':"&quot;","'":"&apos;","\uff02":"&quot;"},initialize:function(a){var e=this;h.Log("new NTKF.Chat()",1);this.inputMaxByte=b.B.MOBILE?100:500;this.url_image=b.imagesResources.url_image;this.url_chat_image=b.imagesResources.url_chat_image;this.url_mobile_image=b.imagesResources.url_mobile_image;this.hasSendAbnormal=new b.H;this.displayedMessage=new b.H;this.settingid=a.settingid;this.siteid=b.siteid;this.sellerid=this.settingid.substr(0,this.settingid.lastIndexOf("_"));
this.itemid=a.itemid;this.itemparam=a.itemparam;this.itemdata=a.itemdata||null;this.destid=a.destid;this.waitSendMessage=a.waitSendMessage;this.reconnectCount=0;this.callMethod=window;this.callMethod.__TCHAT_callbackCustomerServiceInfo=function(){b.fIM_getSessionCustomerServiceInfo.apply(e,arguments)};a.params?(this.single=a.params.single,this.htmlsid=a.params.htmlsid||b.createTimeID()):(this.single=b.globalConfig.single,this.htmlsid=b.createTimeID());this.style=j.extend({tag:{height:39},dialog:{width:300,
height:260}},a.style);this.callback=j.extend({isExpand:new Function("return false;"),open:new Function,close:new Function,max:new Function,switchChat:new Function,flicker:new Function,changeSkin:new Function,setDest:new Function},a.callback);this.user=j.extend({id:"",name:"",logo:"",signature:"",title:""},b.user);this.dest=j.extend({id:"",name:"",status:0,logo:"",signature:"",title:""});this.key=b.randomChar(16);this.id="ntkf_chat_window_"+this.key;this.flashId="ntkf_flash_tchat_"+this.key;this.flashImageId=
"ntkf_flash_image_"+this.key;this.flashFileId="ntkf_flash_file_"+this.key;this.globalTimestamp=b.createTimeID();this.__jdata={type:1,userid:this.user.id,name:this.user.name,logo:this.user.logo};this.enableButtons=new b.H;this.hslColorDifference={color:{bgColor:{h:0,s:0,l:0},borderColor:{h:-5.015432098764983E-4,s:-0.44444444444444464,l:0.27254901960784317},shadowBorder:{h:2.2446689113375662E-4,s:-0.43246839654025304,l:0.19607843137254904},highlightBorder:{h:-5.57546794105912E-4,s:-0.029350104821803225,
l:-0.16470588235294115},centerborder:{h:0,s:0,l:0},tabBgColor:{h:0.0012345679012347732,s:-0.09661835748792258,l:-0.3411764705882353},gradient0:{h:4.175744371823775E-4,s:-0.11111111111111138,l:-0.27647058823529413},gradient1:{h:5.885730691933544E-4,s:-0.05007824726134591,l:-0.19803921568627447},tabNoSelectBorder:{h:8.104796908868783E-4,s:0.029451137884872636,l:0.01176470588235301},otherBgColor:{h:-0.0015432098765431057,s:-0.44444444444444464,l:-0.4372549019607842}},restoreColor:{bgColor:{h:0,s:0,l:0},
borderColor:{h:0,s:0,l:0.027450980392156876},shadowBorder:{h:0,s:0,l:0.027450980392156876},highlightBorder:{h:0,s:0,l:0.027450980392156876},centerborder:{h:0,s:0,l:0},tabBgColor:{h:0,s:0,l:-0.49411764705882355},gradient0:{h:0,s:0,l:-0.4745098039215686},gradient1:{h:0,s:0,l:-0.14117647058823535},tabNoSelectBorder:{h:0,s:-0.004366812227074221,l:-0.20980392156862748},otherBgColor:{h:0,s:0,l:-0.6196078431372549}}};this.defaultSkin={"chat/7":"#4297e0","chat/8":"#4297e0","chat/9":"#4297e0","chat/1":"#4297e0",
"chat/2":"#575757","chat/3":"#575757","chat/4":"#f25488","chat/5":"#52ab52","chat/6":"#9bc942"};this.open()},open:function(){var a=this;setTimeout(function(){a.callback.open.call(a,a.settingid)},0);this._createToolbar(f("#ntkf_chat_toolbars ul"),this.id+"_bar");this._create();this._bindEvent();this._loadWindow()},close:function(a){var e=this,c=function(){e.connect_status="CLOSECHAT";e.disconnectTchat();e._closeToolbar();e.element&&e.element.remove();clearTimeout(e.forFirefoxTimeID);clearInterval(e.keypressTimer);
b.Flash.remove("#"+[e.flashId,e.flashImageId,e.flashFileId].join(",#"));f("#"+e.flashId+"_div").remove();2==b.globalConfig.connectLevel&&!b.IMPRESENCE&&b.t2d.createConnect();x.load(e.chatFlashGoUrl,function(){e.chatFlashGoUrl=""});clearTimeout(e.connectTime);clearInterval(e.waitTimer);e.startWaiting=!1;e.callback.close.call(e,e.settingid);return!0};h.Log(this.settingid+":chat.close()");if(1==this.config.enableevaluation&&!a)this.callStat("23"),setTimeout(function(){if(!e.submitRating&&e.sendNum>=
e.sendNumEnable&&e.connected)e.showSubmitEvaluation(c);else return c()},1E3);else return c()},maximize:function(){this.selected||(h.Log(this.settingid+":maximize()"),this.selected=!0,this.toolbar.css({"border-color":"#ccc","background-color":"#fff"}).addClass("selected"),this.element.css({position:"static",left:"auto",top:"auto",width:this.style.width+"px",height:this.style.height+"px",visibility:"visible"}),this._updateDialog(),this.dest.title=this._getDestTitle(),this.callback.max.call(this,this.settingid,
j.extend({gray:2==this.indexUI?this.enable:!1},this.dest),this.skin))},minimize:function(){this.selected&&(h.Log(this.settingid+":minimize()"),this.selected=!1,this.toolbar.css({"border-color":"#F7F7F7","background-color":"transparent"}).removeClass("selected"),this.element.css({position:"absolute",left:"-1px",top:"-1px",width:"1px",height:"1px",visibility:"hidden"}))},scrollBottom:function(){try{this.area.scrollTop=this.area.scrollHeight,this.area.scrollY=this.area.scrollHeight}catch(a){}},getCustomerServiceInfo:function(a,
e){h.Log(this.settingid+':chat.getCustomerServiceInfo("'+a+'", '+e+', "'+this.user.id+'")',1);this.enableButton(!1);if(1!=this.indexUI){var c=this,d={query:"requestchat",sitid:this.siteid,settingid:this.settingid,uid:this.user.id,uids:a,issingle:e,type:b.globalConfig.userlevel||0,callbackname:"__TCHAT_callbackCustomerServiceInfo"};this.dest.id=a;this.config.service?(this.queryCustomerService="QUERY",x.load(this.config.service.statusUrl+"?"+j.toURI(d)+"#rnd",function(a){if("complete"!=a.status||"QUERY"==
c.queryCustomerService)3>c.reconnectCount?(c.reconnectCount++,setTimeout(function(){c.reconnect()},1E3)):c.switchUI(1,0)},null,{remove:!0})):h.Log("config not loaded",3)}},disconnectTchat:function(){this.connected&&("CLOSECHAT"==this.connect_status?(this.showSystemMessage({msg:i.news_session_end||"Session end.",type:12}),1==this.config.enableevaluation&&(!this.submitRating&&this.sendNum>=this.sendNumEnable&&this.connected)&&this.showSubmitEvaluation()):"COMPLETE"==this.connect_status&&this.showSystemMessage({msg:b.utils.handleLinks(i.news_auto_interrupted,
{settingid:this.settingid}),type:9,disable:1}),this.connected=!1,this.connect_status="DISCONNECT",this.Flash&&this.Flash.closeTChat&&this.Flash.closeTChat(),this.chatFlashGoUrl&&x.load(this.chatFlashGoUrl,function(){self.chatFlashGoUrl=""}),h.Log(this.settingid+": chat.disconnectTchat():"+this.connect_status,2))},reconnect:function(a,e){h.Log(this.settingid+":chat.reconnect()");if(this.key)if(e&&(this.isreconnect=!0),this.connect_status="WAIT",this.Flash&&this.Flash.closeTChat&&this.Flash.closeTChat(),
b.Flash.remove("#"+this.flashId),f("#"+this.flashId+"_div").remove(),this.Flash=null,1==this.indexUI)h.Log("Has entered the message interface , no reconnection",2);else{if(a)for(;"LI"!=a.tagName.toUpperCase();)a.parentNode!=this.historyUL.first()&&(a=a.parentNode);else a=f("li.ntkf-news-system",this.historyUL).last();a&&(f(a).remove(),this.destid=this._getDest(!0));this.getCustomerServiceInfo(this.destid,this.single)}},createConnect:function(){h.Log(this.settingid+":chat.createConnect()",1);var a=
this,e,c,d,g;this.Flash?h.Log("Flash:"+this.Flash):(this.connectTime=setTimeout(function(){h.Log("60 seconds turned to comment");a.switchUI(1,3)},6E4),e={siteid:this.siteid,settingid:this.settingid,surl:b.url_service,rurl:b.url_resource,u:this.user.id,n:this.user.name,groupid:this.dest.id||this.destid,sid:this.dest.sid,cid:b.globalConfig.machineid,htmlsid:this.htmlsid,statictis:b.globalConfig.statictis,userlevel:b.globalConfig.userlevel,disconnecttime:this.config.contime||180,mini:0,chattype:b.globalConfig.chattype||
"1",chatvalue:3==b.globalConfig.chattype?b.globalConfig.inviteid:b.globalConfig.chatvalue||"0"},this.connect_status="CREATE","COMET"==b.chatConnectType?F(function(){a.Flash=new b.tchat(j.extend(e,{usertoken:b.usertoken}))},"cometd.js?version="+b.version_cometd,b.cometd):(g=this.flashId+"_div",d=f("#"+g),c=b.url_resource+"/fs/TChat.swf?v="+b.version_tchat,d.length||(d=f({id:g,style:"position:absolute;z-index:9996;top:-200px;"})),c=n.IE&&11>n.IE_VER?['<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="'+
b.protocol+'//download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,28" ',' id="'+this.flashId+'" name="'+this.flashId+'" width="1" height="1"> ','<param name="movie" value="'+c+"&rnd="+b.createTimeID()+'" /> ','<param name="allowscriptaccess" value="always" /> ','<param name="flashvars" value="'+j.toURI(e)+'" /> ',"</object>"].join(""):n.IE&&11<=n.IE_VER?['<object id="'+this.flashId+'"  name="'+this.flashId+'" type="application/x-shockwave-flash" data="'+c+"&rnd="+b.createTimeID()+
'" width="1" height="1">','<param name="movie" value="'+c+"&rnd="+b.createTimeID()+'"/>','<param name="quality" value="high"/><param name="allowscriptaccess" value="always"/>','<param name="flashvars" value="'+j.toURI(e)+'" /> ',"</object>"].join(""):'<embed src="'+c+'" id="'+this.flashId+'" name="'+this.flashId+'" width="1" height="1" flashvars="'+b.A.toURI(e)+'" allowscriptaccess="always" pluginspage="'+b.protocol+'//www.macromedia.com/go/getflashplayer" type="application/x-shockwave-flash" ></embed>',
d.html(c),n.IE&&f("#"+this.flashId).css("display","block"),this.Flash=f("#"+this.flashId).first(),n.Firefox&&(a.forFirefoxTimeID=setTimeout(function(){h.Log("Under firefox not ready TCHAT more than 5 seconds",2);b.chatConnectType="COMET";a.reconnect()},5E3))))},switchUI:function(a,e,c){h.Log(this.settingid+":chat.switchUI("+r.toJSONString(arguments)+")");this.indexUI=a||0;if(2==a)f(".ntkf-chat-child-offline,.ntkf-chat-child-load",this.element).hide(),f(".ntkf-chat-child-online",this.element).show();
else if(1==a){clearInterval(this.waitTimer);clearTimeout(this.connectTime);clearInterval(this.keypressTimer);this._hidenDialog();this.startWaiting=!1;this.connectTime=null;this.connected=!1;""==f(".ntkf-comment-form-table",this.element).html()&&this._initComment();f("input[name=source]",this.element).value(e||"0");f(".ntkf-chat-child-online,.ntkf-chat-child-load",this.element).hide();f(".ntkf-chat-child-offline",this.element).show();try{this.Flash.closeTChat()}catch(d){}f(this.Flash).remove();this.callStat("22");
this.callback.changeStatus()}else f(".ntkf-chat-child-offline,.ntkf-chat-child-online",this.element).hide(),f(".ntkf-chat-child-load",this.element).show(),this.error.html(c);2!=a&&(this.Flash&&this.Flash.closeTChat&&this.Flash.closeTChat(),b.Flash.remove("#"+[this.flashId,this.flashImageId,this.flashFileId].join(",#")),f("#"+this.flashId+"_div").remove())},enableButton:function(a,b){h.Log(this.settingid+":chat.enableButton("+a+", "+(b?b:"all")+")");var c=this,d=function(a,b){if(a!=c.enableButtons.items(b).enable)if(c.enableButtons.items(b).enable=
a,c.Flash_File&&/^ntkf\-icon\-file$/.test(b)){if(c.Flash_File.enableUpload)try{c.Flash_File.enableUpload(a)}catch(e){}}else if(c.Flash_Image&&/^ntkf\-icon\-image$/.test(b)){if(c.Flash_Image.enableUpload)try{c.Flash_Image.enableUpload(a)}catch(d){}}else f("."+b,c.buttons.parent().parent()).css("opacity",a?"1":"0.5"),f("."+b+" span",c.buttons.parent().parent()).css("cursor",a?"pointer":"auto")};b?d(a,b):(this.enableButtons.each(function(b){a&&"ntkf-icon-evaluation"==b||d(a,b)}),this.submit.css("opacity",
a?"1":"0.5"),(this.enable=a)?(this.connected=!0,this.online()):(this.connected=!1,this.offline()))},online:function(){this.header.css({"border-color":"#47C000","background-color":"#91DB00"})},offline:function(){this.header.css({"border-color":"#8A8A8A","background-color":"#BDBFBE"})},changeSkin:function(a){h.Log(this.settingid+':chat.changeSkin("'+a+'")');var e=this;if(a&&!b.Color.isHex(a))return!1;this.baseColor=a;this.skin={bgColor:e._skinColor(),borderColor:e._skinColor("borderColor"),shadowBorder:e._skinColor("shadowBorder"),
highlightBorder:e._skinColor("highlightBorder"),centerborder:e._skinColor("centerborder"),tabBgColor:e._skinColor("tabBgColor"),gradient0:e._skinColor("gradient0"),gradient1:e._skinColor("gradient1"),tabNoSelectBorder:e._skinColor("tabNoSelectBorder"),otherBgColor:e._skinColor("otherBgColor"),highlight:{color:"#fff","border-color":"#cd7000",gradient0:"#fe992e",gradient1:"#e77d09"}};this.element.css("border-color",this.skin.borderColor);f(".ntkf_tab_container",this.element).css("border-color",this.skin.borderColor);
f("li",this.tagElement).each(function(a){-1!=a.className.indexOf("selected")?(f("span",a).gradient("top","#d4d4d4","#ffffff"),f(a).css("border-color",e.skin.borderColor)):(f("span",a).gradient("top",e.skin.gradient0,e.skin.gradient1),f(a).css("border-color",e.skin.tabNoSelectBorder))});b.B.MOBILE?f(".ntkf-chat-container input[type=button]").css("background-color",this.skin.bgColor):f(".ntkf-button-submit,.ntkf-chat-container input[type=button]").css("background-color",this.skin.bgColor);f(".ntkf-chat-child-left",
this.element).css("border-color",this.skin.centerborder);f(".ntkf-chat-child-right",this.element).css("background-color",this.skin.tabBgColor);this.callback.changeSkin.call(this,this.skin)},showInputState:function(){var a=this;"none"==this.inputstate.css("display")&&this.inputstate.show(!0);clearTimeout(this.inputStateTimer);this.inputStateTimer=setTimeout(function(){a.inputstate.hide(!0)},2E3)},cancelUpload:function(a){var e="uploadfile"==a?"Flash_File":"Flash_Image";h.Log(this.settingid+':chat.cancelUpload("'+
e+'")');try{this[e].cancelUpload(),this.showMessage({type:10,selectorRemove:a+"_id_replace_upload",msg:b.utils.handleLinks(i.news_cancel_trans,{type:"uploadfile"==a?i.button_file:i.button_image})})}catch(c){h.Log(c,3)}},formatEvaluate:function(a){var b,a=this.charFilter(a);b=j.wget({},a,"type msgid oldfile size sourceurl url".split(" "));for(var c in b)void 0===b[c]&&delete b[c];a={action:"onremark",myuid:a.userid,clientid:this.clientid,sessionid:this.dest.sid,flashuid:a.timerkeyid,msg:{msg:j.extend(a.msg,
{attributes:b})}};a.msg.msg.evaluate&&(a.msg.msg.evaluate=r.toJSONString(a.msg.msg.evaluate));a.msg=D.jsonToxml(a.msg);return a},charFilter:function(a){var e=this,c,d=function(a){for(var b in e.entityList)"function"!=typeof e.entityList[b]&&(pattern=""+b+"",a=a.replace(RegExp(pattern,"g"),e.entityList[b]));return a};if(b.isArray(a)){c=[];for(var g=0;g<a.length;g++)c[g]="object"==typeof a[g]?this.charFilter(a[g]):"string"==typeof a[g]?d(a[g]):a[g]}else if("object"==typeof a)for(g in c={},a)"function"!=
typeof a[g]&&(c[g]="object"==typeof a[g]?this.charFilter(a[g]):"string"==typeof a[g]?d(a[g]):a[g]);else c=d(a);return c},send:function(a){var e=this.editor.value().toString().replace(/^(&nbsp;)?\s+(&nbsp;)?|(&nbsp;)?\s+(&nbsp;)?$/gi,""),c=b.createTimeID();if(4!=this.dest.status&&this.Flash)if(c<=this.globalTimestamp&&(c+=1),this.globalTimestamp=c,a=j.extend({},this.__jdata,{type:1,msgid:c+"j",timerkeyid:c,msg:e},a),p.len(a.msg)>this.inputMaxByte&&(a.msg=p.cut(a.msg,this.inputMaxByte/2)),/^(1|2|4|9|10|11)$/ig.test(a.type)&&
!a.msg||/^(9|10|11)$/ig.test(a.type))h.Log("The system does not send a message or an empty message");else if(!this.connected&&/^(1|2|4)$/ig.test(a.type))h.Log("cache save message and reconnectTchat",1),this.isreconnect?h.Log("connect..."):this.reconnect(null,!0);else if(!this.connected&&/^(5)$/ig.test(a.type))a.msg&&3===a.msg.msgtype&&new b.POST(this.chatgourl,this.formatEvaluate(a),[function(){h.Log("evaluate submit complete.",1)},function(){h.Log("evaluate submit failed.",2)}]);else if(1==a.type&&
this.editor.value(""),this.first&&/^1|2|4$/i.test(a.type)&&this._firstSendMessage(),this.showMessage(a),/^(5)$/ig.test(a.type)&&a.msg&&3===a.msg.msgtype&&this.Flash.cometd)new b.POST(this.chatgourl,this.formatEvaluate(a),[function(){h.Log("evaluate submit complete.",1)},function(){h.Log("evaluate submit failed.",2)}]);else{try{h.Log(this.settingid+":chat.Flash.sendMessage("+b.J.toJSONString(a)+");",5==a.type?1:0),this.Flash.sendMessage(b.J.toJSONString(a))}catch(d){h.Log(this.settingid+":chat.Flash.sendMessage::"+
d.message,3)}/^(2|4)$/.test(a.type)&&!this.submitRating&&(this.enableButton(!0,"ntkf-icon-evaluation"),this.sendNum++)}},receive:function(a){h.Log(this.settingid+":chat.receive("+r.toJSONString(a)+")");a.userid==this.user.id?(a=j.extend(a,{name:this.user.name,logo:this.user.logo}),/^(2|4)$/.test(a.type)&&(a.msg=i.news_trans_complete)):(b.promptwindow.startPrompt("",i.news_new,!0),a.logo=this.dest.logo,/^(2|4)$/.test(a.type)&&(a.msg=i.news_receiver_complete));if(9==a.type)switch(a.msgType){case 1:a.msg=
b.String(i.connect_timeout).toString();break;case 2:a.msg=b.utils.handleLinks(i.news_send_failure,{message:b.S.cut(a.msg,15,1),settingid:this.settingid,msgid:a.msgid});this.hasSendAbnormal.add(a.msgid,a.body);break;default:a.msg=b.String(i.news_send_return).toString()}else a.timestamp=parseInt(a.timestamp)+parseInt(this.JetLag);this.showMessage(a);this.user.id!=a.userid&&"1"!=a.history&&(this.selected||this.flicker(),this.callback.flicker.call(this,this.settingid))},resend:function(a,e){var c=this.hasSendAbnormal.items(a);
e&&f(e).css({color:"#999","text-decoration":"none",cursor:"default"}).attr("onclick",new Function);if(c)try{this.Flash.sendMessage(b.J.toJSONString(c))}catch(d){h.Log(this.settingid+":chat.Flash.sendMessage::"+d.message,3)}},clear:function(){f("li.ntkf-news-system",this.historyUL).remove()},flicker:function(a,b){var c=this,d="undefined"==typeof b?0:b,g=a?1E3:500;!0==this.stopFlashing?this.stopFlashing=!1:("undefined"==typeof a&&(clearTimeout(this.time),this.time=null,this.minChatMessageCount++,this.toolbar.css({color:"#fff",
"background-color":this.bgColor}).gradient(!1)),this.toolbar.first()&&(a?this.toolbar.css({color:"#fff","border-color":"#cd7000"}).gradient("top","#fe992e","#e77d09"):this.toolbar.css({color:"#fff","border-color":this.skin.borderColor}).gradient(!1).css("background-color",this.skin.bgColor),7<=d||(this.time=setTimeout(function(){d+=1;c.flicker(!a,d)},g))))},stopFlicker:function(){this.stopFlashing=!0;this.toolbar.css("color","#000").gradient(!1)},showMessage:function(a){var e=this,c,d="";!a.msgid&&
a.timerkeyid&&(a.msgid=a.timerkeyid+(a.userid==this.user.id?"j":"true"==a.msgsystem?"S":"C"));if(a.msgid){if(this.displayedMessage.contains(a.msgid))return;this.displayedMessage.add(a.msgid,a)}for(;f("LI",this.historyUL).length>=this.showMaxNumber;)f(f("LI",this.historyUL).first()).remove();a.selectorRemove&&-1<a.selectorRemove.indexOf("_id_replace_upload")?d=a.selectorRemove:a.selectorRemove&&f("."+a.selectorRemove.replace(/,/g,", ."),this.historyUL).remove();var g=a.name||"",l=a.userid||"",h=p.formatDate(a.timestamp||
a.timerkeyid,"h:i:s"),j=a.title||"",m=a.msg,k=a.type||1,B=a.selectorWaitRemove||"",q=b.B.MOBILE?{background:["#E0DFDF","#D5E3C9","#F2CDCF"],border:["0px","0px","0px"]}:{background:["#F1F1F1","#EEFEE2","#F2DEDE"],border:["1px solid #DEDDDD","1px solid #D9E7D4","1px solid #F4BDBD"]};if(m){"string"==typeof m&&/^(1|2|4)$/gi.test(k)&&(m=m.replace(/[\r|\n]/ig," <br />"),m=this._filterFace(b.String(m).linkfilter("margin:0;padding:0;border:0;font:normal 12px/160% Arial,SimSun;color:#0a8cd2;"),"IN"),m=m.replace(/(\s{2})/gi,
"&nbsp;&nbsp;"));if("5"!=k){var r,w,s="list-style:none outside none;margin:0 0 7px 0;display:block;float:none;font:normal normal 0px/0px Arial,SimSun;font-size:0px;",v="margin:0;padding:0;border:0;width:auto;height:auto;left:none;top:none;float:none;overflow:visible;font:normal normal 0px/0px Arial,SimSun;font-size:0px;",u="overflow:visible;float:none;color:#333;padding:4px;margin:0;font:normal normal 0px/0px Arial,SimSun;font-size:0px;display:inline-block;";r=/^9$/.test(k)?"bottom:-6px;float:left;left:-16px;display:block;position:relative;font:0px/0px Arial;height:15px;width:12px;margin:0;padding:0;text-align:center;background:"+
(b.B.MOBILE?"url("+this.url_mobile_image+") no-repeat scroll 2px -275px":"url("+this.url_chat_image+") no-repeat scroll 1px -300px")+";":l==this.user.id||/^(10|11)$/.test(k)?"bottom:-6px;float:right;right:-15px;display:block;position:relative;font:0px/0px Arial;height:15px;width:12px;background:"+(b.B.MOBILE?"url("+this.url_mobile_image+") no-repeat scroll 0px -250px":"url("+this.url_chat_image+") no-repeat scroll 1px -320px")+";margin:0;padding:0;text-align:center;":"bottom:-6px;float:left;left:-15px;display:block;position:relative;font:0px/0px Arial;height:15px;width:12px;margin:0;padding:0;text-align:center;background:"+
(b.B.MOBILE?"url("+this.url_mobile_image+") no-repeat scroll 2px -225px":"url("+this.url_chat_image+") no-repeat scroll 1px -340px")+";";w=l==this.user.id||/^(10|11)$/.test(k)?"position:relative;right:-10px;text-align:right;float:right;margin:0;padding:0;font:normal 12px/160% Arial, SimSun;color:#888;":"position:relative;left:-10px;text-align:left;float:left;margin:0;padding:0;font:normal 12px/160% Arial, SimSun;color:#888;";l!=this.user.id&&(l!=this.dest.id&&"system"!=l)&&(h=g+" "+h);r=(l==this.user.id||
/^(10|11)$/.test(k),'<span style="'+r+'"></span><span style="'+w+'">'+h+"</span>");switch(parseInt(k)){case 2:s+=l==this.user.id?"text-align:right;padding:0 0 0 30px;":"text-align:left;padding:0 30px 0 0;";v+=l==this.user.id?"text-align:right;width:auto;":"text-align:left;";u+=l==this.user.id?"background:"+q.background[1]+";border:"+q.border[1]+";text-align:left;":"background:"+q.background[0]+";border:"+q.border[0]+";";g="";h=l==this.user.id?"ntkf-news-send":"ntkf-news-receive";m='<img class="imagetrans-image" src="'+
a.url+'" sourceurl="'+a.sourceurl+'" style="cursor:pointer;margin:0;padding:0;border:0;text-align:'+(l==this.user.id?"right":"left")+'" />';break;case 4:s+=l==this.user.id?"text-align:right;padding:0 0 0 30px;":"text-align:left;padding:0 30px 0 0;";v+=l==this.user.id?"text-align:right;":"text-align:left;";u+=l==this.user.id?"background:"+q.background[1]+";border:"+q.border[1]+";":"background:"+q.background[0]+";border:"+q.border[0]+";";g="-46px -108px";h=l==this.user.id?"ntkf-news-send":"ntkf-news-receive";
m=l==this.user.id?b.utils.handleLinks(i.news_send_file,{file:'<b style="margin:0;padding:0;font:bold 12px/160% Arial,SimSun;color:#333;">'+a.oldfile+"</b>",size:a.size,message:m}):b.utils.handleLinks(i.news_receive_file,{file:'<b style="margin:0;padding:0;font:bold 12px/160% Arial,SimSun;color:#333;">'+a.oldfile+"</b>",size:a.size,message:m,url:a.url});break;case 9:s+="text-align:left;padding:0 30px 0 0;";v+="text-align:left;";u+="background:"+q.background[2]+";border:"+q.border[2]+";";g="-46px -17px";
h="ntkf-news-system";break;case 10:s+="text-align:right;padding:0 0 0 30px;";v+="text-align:right;";u+="background:"+q.background[1]+";border:"+q.border[0]+";";g="-46px -233px";h="ntkf-news-system";break;case 11:s+="text-align:right;padding:0 0 0 30px;";v+="text-align:right;";u+="background:"+q.background[1]+";border:"+q.border[0]+";";g="-46px -108px";h="ntkf-news-system";break;case 12:s+="text-align:left;padding:0 30px 0 0;";v+="text-align:left;";u+="background:"+q.background[0]+";border:"+q.border[0]+
";";g="-46px -108px";h="ntkf-news-system";break;default:1!=a.history&&"true"!==a.msgsystem&&this.sendNum++,this.sendNum==this.sendNumEnable&&!this.submitRating&&this.enableButton(!0,"ntkf-icon-evaluation"),v+=l==this.user.id?"text-align:right;":"text-align:left;",l==this.user.id?(s+="text-align:right;padding:0 0 0 30px;",u+="background:"+q.background[1]+";border:"+q.border[1]+";",g="",h="ntkf-news-send"):(s+="text-align:left;padding:0 30px 0 0;",u+="background:"+q.background[0]+";border:"+q.border[0]+
";",g="",h="ntkf-news-receive",m=m.replace(/\{ntalker\:leavemessage\}/ig,G+i.go_message+"</a>"))}g=g?"background:url("+this.url_chat_image+") no-repeat scroll "+g+";text-indent:2em;":"";html=['<div class="imagetrans-image-lidiv" style="'+v+'">','<div style="'+u+'">','<div style="margin:0;padding:0;border:0;float:none;text-align:left;font:normal normal 0px/0px Arial,SimSun;display:inline;">',j?'<div style="margin:0;padding:0;float:none;text-align:left;font:normal normal 12px/150% Arial, SimSun;color:#333;background:url('+
this.url_chat_image+') no-repeat scroll -46px -108px;text-indent:2em;">'+j+"</div>":"",'<p style="margin:0;padding:0;float:none;text-align:'+(l==this.user.id&&2==k?"right":"left")+";font:normal normal 12px/150% Arial, SimSun;color:#333;table-layout:fixed;word-break:break-all;word-wrap:break-word;"+(!j?g:"")+'">'+m+"</p>","</div>",r,"</div></div>"].join("");c=f(f("."+d,this.element).last());d&&c.length?c.replaceClass(d,h).replaceClass("ntkf-news-system",h).attr("id",a.msgid||""):(c=f({tagName:"LI",
id:a.msgid||"",className:B?B+" "+h:h}),this.historyUL&&this.historyUL.first().appendChild(c.first()));a.mobile?c.cssText(s+"padding:15px;background:"+q.background[0]+";font:14px/160% Arial,SimSun;text-align:center;color:#666;-moz-border-radius:8px;-webkit-border-radius:8px;border-radius:8px;").html(i.news_connect_complete_mobile):c.cssText(s).html(html);2==k&&(x.load(a.url+"#image",function(a,b){setTimeout(function(){f(".imagetrans-image-lidiv",c).css({height:28+(b.height||100)+"px"});e.area.scrollTop=
e.area.scrollHeight-e.area.offsetHeight},300)}),f(".imagetrans-image",c).bind("click",function(a,b){e._viewImage(b)}).bind("onload",function(a){e._picturesOnLoad(a,l==e.user.id&&n.IE8?!0:!1,this)}))}setTimeout(function(){e.scrollBottom()},300)}},showSystemMessage:function(a){a=j.extend({msg:"",type:9,disable:0,selectorWaitRemove:"",selectorRemove:"",mobile:0},a);a.disable&&(this.enableButton(!1),this.dest.title=this._getDestTitle(),this.selected&&this.callback.max.call(this,this.settingid,j.extend({gray:2==
this.indexUI?this.enable:!1},this.dest),this.skin));0===a.disable&&this.enableButton(!0);a.mobile&&this.createMobileItem();this.showMessage({userid:"system",type:a.type||11,mobile:a.mobile||!1,msg:a.msg,selectorWaitRemove:a.selectorWaitRemove||"",selectorRemove:a.selectorRemove||""})},createMobileItem:function(){if(!f(".ntkf_mobile_proinfo",this.element).length){if(!this.itemid&&(b.globalConfig.proinfo&&(this.itemid=b.globalConfig.proinfo),!this.itemid))return;var a=this;x.load(b.url_mcenter+"/goodsinfo/api.php?"+
j.toURI({siteid:"kf"==this.siteid.substr(0,2)?this.siteid:this.siteid.substr(0,3)+"1000",itemid:this.itemid,itemparam:this.itemparam,user_id:b.user.shortID,type:"jsonp",callback:"mobile_iteminfo"}),function(b){"complete"==b.status&&!("undefined"==typeof mobile_iteminfo||!1===mobile_iteminfo.result)&&a.showMobileItem(mobile_iteminfo.item)})}},showMobileItem:function(a){var e,c="",d=[];e=['<div class="ntkf_mobile_proinfo" style="margin:15px;padding:0px;width:auto;height:1;border:1px solid #ccc;overflow:hidden;background:#FFF;">',
'<div class="ntkf_mobile_image" style="margin:10px;padding:0;border:0;width:90px;height:90px;float:left;"><img src="'+this.url_image+'/blank.gif" border="0" /></div>','<div class="ntkf_mobile_proname" style="margin:10px 0 0 10px;padding:0;border:0;left:120px;">','<div class="ntkf_mobile_name" style="margin:0;padding:0;border:0;font:normal 12px/160% Arial,SimSun;color:#333;max-height:60px;overflow:hidden;">'+a.name+"</div>",'<div class="ntkf_mobile_price" style="margin:5px 0 0 0;padding:0;border:0;"><span style="font:bold 16px/160% Arial,SimSun;color:#D00;">{$price}</span></div></div><div style="margin:0;padding:0;border:0;line-height:0;clear:both;"></div><div class="ntkf_mobile_proattrs" style="margin:10px 10px 0 10px;padding:0;border:0;border-top:1px solid #eee;font:normal 12px/24px Arial,SimSun;color:#666;">{$attributes}<div style="margin:0;padding:0;border:0;width:100%;line-height:0;clear:both;"></div></div></div>'].join("");
for(var g in a)"function"==typeof a[g]||/^(name|id|url|imageurl)$/gi.test(g)||(-1<g.indexOf("price")?"string"==typeof a[g]&&(c=a[g]):b.isArray(a[g])?d.push('<div style="margin:0;padding:0;border:0;width:50%;float:left;white-space: nowrap;">'+(""==a[g][0]?"":a[g][0]+": ")+a[g][1]+"</div>"):"object"==typeof a[g]?d.push('<div style="margin:0;padding:0;border:0;width:50%;float:left;white-space: nowrap;">'+(""==a[g][0]?"":a[g][0]+": ")+a[g][1]+"</div>"):d.push('<div style="margin:0;padding:0;border:0;width:50%;float:left;white-space: nowrap;">'+
a[g]+"</div>"));e=e.replace(/\{\$price\}/gi,c);e=e.replace(/\{\$attributes\}/gi,d.reverse().join(""));d.length&&(this.historyUL.parent().insert(e),x.load(a.imageurl,function(b,c){"complete"==b.status&&f(".ntkf_mobile_image",this.element).html('<a href="'+a.url+'" target="_blank"><img src="'+c.src+'" width="90" height="90" /></a>');f(".ntkf_mobile_proinfo",this.element)}))},showSubmitEvaluation:function(a){this.selected||(this.flicker(),this.callback.flicker.call(this,this.settingid));if(!this.dialogButton){var e=
this,c,d,g=b.B.MOBILE?"#7C94B2":this._skinColor(),l=b.B.MOBILE?"#CCC":this._skinColor("borderColor"),h=function(a){j.each(a,function(b,c){if("object"==typeof b)a[c]=h(b);else if("number"==typeof b)a[c]=b;else try{a[c]=b.replace(/[\r\n]/gi,"")}catch(d){}});return a},t=function(c){e.submitRating=!0;e._hidenDialog();c=h(c);if(0!=e.config.form_type)e.send({type:5,msg:{msgtype:3,evaluatestar:c[0].value.value||5,remark:c[1]?c[1].value:""}}),e.showMessage({type:11,msg:b.utils.handleLinks(i.news_evaluation,
{evaluation:c[0].value.text})});else{e.send({type:5,msg:j.extend({msgtype:3},{evaluate:c})});d={type:11,msg:""};for(var g in c)c[g]&&(c[g].value&&"function"!=typeof c[g])&&(d.msg+=("string"==typeof c[g].value?c[g].value:c[g].value.text)+"; ");d.msg=b.S.cut(d.msg,120);d.msg=b.utils.handleLinks(i.news_evaluation,{evaluation:d.msg});e.showMessage(d)}e.enableButton(!1,"ntkf-icon-evaluation");a&&setTimeout(function(){a.call(e)},500)};if(!this.config.form_evaluation||"string"==typeof this.config.form_evaluation||
!this.config.form_evaluation.length)this.config.form_evaluation=this.config.evaluation_form;if(!this.config.form_evaluation||"string"==typeof this.config.form_evaluation||!this.config.form_evaluation.length)this.config.form_evaluation=i.default_evaluation_form_fields;this.config.evaluation_form_title||(this.config.evaluation_form_title=i.default_evaluation_form_title);if(!0==this.submitRating)this.showMessage({type:11,msg:i.news_ready_evaluation,selectorWaitRemove:"ntkf_ready_evaluation",selectorRemove:"ntkf_ready_evaluation"});
else{for(var m=['<table border="0" cellpadding="0" cellspacing="0" style="margin:0px 0 10px 0;padding:0;width:100%;height:auto;background:transparent;">','<tr style="margin:0;padding:0;border:0;"><td colspan="2" style="margin:0;padding:0;border:0;border-top-left-radius:5px;border-top-right-radius:5px;text-align:left;font:normal 12px/24px Arial,SimSun;color:#fff;height:24px;background:'+g+';"><span style="margin:0 0 0 10px;padding:0;border:0;">'+this.config.evaluation_form_title+"</td></tr>"].join(""),
k=0;k<this.config.form_evaluation.length;k++)this.config.form_evaluation[k]=j.extend(this.config.form_evaluation[k],{titlewidth:/zh_cn|en_us/ig.test(i.language)?"5px":"10px",inputwidth:"auto",optionLine:!0,messageid:"NEWS_"+this.config.form_evaluation[k].name}),"textarea"==this.config.form_evaluation[k].type&&(this.config.form_evaluation[k]=j.extend(this.config.form_evaluation[k],{input:{width:"95%",height:"40px"}}));m+=b.FORM.createInput(this.config.form_evaluation);m+=['<tr style="margin:0;padding:0;border:0;"><td colspan="2" style="margin:0;padding:10px 0 0;border:0;text-align:center;font:normal 12px/160% Arial,SimSun;color:#333;"><input type="button" class="ntkf-alert-submit" value="'+
i.tips_evaluation_button_text+'" style="margin:0;padding:0 5px;border:0;width:auto;height:24px;color:#fff;font:normal 12px/24px Arial,SimSun;background:'+g+';" /></td></tr>',"</table>"].join("");c=this._showDialog(m,{width:n.MOBILE&&!n.IPAD?280:336,height:260,borderColor:l});b.FORM.bindFormEvent(this.config.form_evaluation,c);f(".ntkf-alert-submit",this.element).bind("click",function(){b.FORM.verificationForm(e.config.form_evaluation,t,c)})}}},showSubmitUserInfo:function(a){if(!this.dialogButton){var e=
this,c,d=function(c){e._hidenDialog();b.globalConfig.cacheUserInfo=c;b.CACHE.save("submituserinfo",1);a.call(e)};if(!this.config.form_submitinfo||"string"==typeof this.config.form_submitinfo||!this.config.form_submitinfo.length)this.config.form_submitinfo=this.config.submitinfo_form;if(!this.config.form_submitinfo||"string"==typeof this.config.form_submitinfo||!this.config.form_submitinfo.length)this.config.form_submitinfo=i.default_submitinfo_form_fields;for(var g=['<table border="0" cellpadding="0" cellspacing="0" style="margin:0px 0 10px 0;padding:0;width:100%;height:auto;background:transparent;">',
'<tr><td colspan="2" style="margin:0;padding:15px 10px 3px;border:0;text-align:center;font:normal 12px/160% Arial,SimSun;color:#333;">'+i.tips_submit_news+"</td></tr>"].join(""),l,j=0;j<this.config.form_submitinfo.length;j++)l=!!/^zh_cn$/ig.test(i.language),this.config.form_submitinfo[j]=b.A.extend(this.config.form_submitinfo[j],{titlewidth:(l?80:150)+"px",inputwidth:(l?220:150)+"px",input:{width:"90%"}});g+=b.FORM.createInput(this.config.form_submitinfo);g+=['<tr><td colspan="2" style="margin:0;padding:0px 0;border:0;text-align:center;"><input type="button" class="ntkf-alert-submit" id="submitbutton" value="'+
i.tips_button_text+'" style="border:1px solid #ccc;margin:0;padding:0 10px;border:0;width:auto;height:24px;color:#fff;font:normal 12px/24px Arial,SimSun;background:'+this._skinColor()+';" /></td></tr>',"</table>"].join("");c=this._showDialog(g,{width:300,height:260,borderColor:this._skinColor("borderColor")});b.FORM.bindFormEvent(this.config.form_submitinfo,c);f(".ntkf-alert-submit",this.element).bind("click",function(){h.Log("Submit");b.FORM.verificationForm(e.config.form_submitinfo,d,c)})}},captureImageDownload:function(){var a=
b.utils.handleLinks(i.capture_download,{url:b.url_resource+"/captureImage_"+i.language.toLowerCase()+".zip"});this._CallBack("fIM_receiveUploadFailure",["","image",a,this.settingid])},captureImageCallBack:function(a){var e=this;e._CallBack("fIM_startSendFile",["","image",a.name,e.settingid]);var c=e.config.service.fileServer,d=a.name,g=a.name.replace(/^.*?\./ig,"");savefile=b.createTimeID()+"."+g;savepath="/imagesave/"+savefile;size=parseInt(100*(a.size/1024))/100;new b.POST(c+"/upload.php",{action:"uploadimage",
oldfile:d,savefile:savefile,data:a.Img_base64,size:a.size},[function(){h.Log(e.settingid+":chat.initButtons() Submit a image file successfully.",1);e._CallBack("fIM_receiveUploadSuccess",["","image",{type:2,msg:i.news_trans_complete,url:c+"/image.php?f="+b.Base64.encode(d)+"&q="+b.Base64.encode(savepath),oldfile:d,size:size+" KB",extension:g,sourceurl:c+"/download.php?f="+b.Base64.encode(d)+"&q="+b.Base64.encode(savepath)},e.settingid])},function(){h.Log(e.settingid+":chat.initButtons() Failure to submit the image file.",
3);e._CallBack("fIM_receiveUploadFailure",["","image",b.utils.handleLinks(i.capture_post_failure,{file:'<b style="margin:0;padding:0;font:bold 12px/160% Arial,SimSun;color:#333;">'+d+"</b>",size:json.size}),e.settingid])}])},_CallBack:function(a,e){e.push(this.settingid);b[a]?b[a].apply(this,e):h.Log("NTKF."+a+"(...)",2)},callStat:function(a){if(0===b.globalConfig.statictis){if(/^(0|1|2|4|5|6|7|8|18|19|20|21)$/ig.test(a))return!1}else if(2===b.globalConfig.statictis&&!/^(10|11|12|13|22|23)$/ig.test(a))return!1;
h.Log(this.settingid+":chat.callStat("+a+")");x.load(b.url_mcenter+"statistic.php?"+b.A.toURI({m:"Count",a:"collection",type:"chatjs",siteid:this.siteid,guestid:this.user.id,action:a,htmlsid:this.htmlsid,chatsession:this.dest.sid})+"#rnd");return!0},initButtons:function(){this.destid||(this.destid=this._getDest(!0));this.config.enterprise.evaluation||(f(".ntkf-icon-evaluation",this.element).hide(),b.B.MOBILE&&f(".ntkf-chat-editor-arear",this.element).css("marginLeft","40px"));(0==this.config.enterprise.captureimage||
n.MOBILE)&&f(".ntkf-icon-captureImage",this.element).hide();this.config.enterprise.chatingrecord||f(".ntkf-icon-record",this.element).hide();this.config.enterprise.transferfiles||f(".ntkf-icon-image, .ntkf-icon-file",this.element).hide();0==this.config.enable_face&&(f(".ntkf-icon-face",this.element).hide(),b.B.MOBILE&&f(".ntkf-chat-editor-arear",this.element).css("marginLeft",!this.config.enterprise.evaluation?"0px":"40px"));this.destid?b.Flash.supportFlash()&&!b.B.MOBILE?(this.Flash_Image=this._createFlash("ntkf-icon-image",
this.flashFileId,"uploadimage",i.button_image),this.Flash_File=this._createFlash("ntkf-icon-file",this.flashImageId,"uploadfile",i.button_file)):f(".ntkf-icon-image,.ntkf-icon-file",this.element).hide():(this.switchUI(0,0,i.load_no_customerservice),f(".ntkf-chat-bar-name",this.toolbar).html(i.toolbar_allocation_failure))},_firstSendMessage:function(){this.callStat("20");this.first=!1;this.itemdata?this.send({type:5,msg:{msgtype:5,productInfoURL:b.url_mcenter+"goodsinfo/index.php?"+j.toURI({siteid:this.siteid,
itemdata:p.decToHex(r.toJSONString(this.itemdata)),charset:b.charset,type:2,rnd:b.createTimeID()})}}):""!=this.itemid&&this.itemid&&this.send({type:5,msg:{msgtype:5,productInfoURL:b.url_mcenter+"shopiteminfo/iteminfo.php?"+j.toURI({siteid:this.siteid,itemid:this.itemid,itemparam:this.itemparam,user_id:this.user.shortID,rnd:b.createTimeID()})}});1==this.config.submitinfo&&(this.send({type:5,msg:{msgtype:1,contactinfo:b.globalConfig.cacheUserInfo}}),this.callStat("3"))},_loadWindow:function(){h.Log(this.settingid+
":chat._loadWindow()");var a=this,e,c;a.switchUI(0,0,b.utils.handleLinks(i.loading,{count:50}));b.defaultConfig.settingid==this.settingid&&b.defaultConfig.version?(this.config=j.extend({},b.defaultConfig,{message_skin:this.defaultSkin[b.defaultConfig.message_skin]||b.defaultConfig.message_skin}),c=a._initTab(),a.changeSkin(a.config.message_skin),a._switchTab(c),a.switchUI(2),a.initButtons(),a.sendNumEnable=a.config.send_msgnum_enable||a.sendNumEnable,a.config.enableevaluation=a.config.enterprise.enableevaluation||
a.config.enableevaluation,a.getCustomerServiceInfo(a.destid,a.single)):(e=this.settingid.substr(0,this.settingid.lastIndexOf("_"))+"_"+this.settingid+".js?version="+b.version+"#buffer",x.load(b.url_service+"/config/"+e,function(d){"complete"==d.status?"undefined"==typeof b.CONFIG?a.switchUI(0,0,b.utils.handleLinks(i.load_failure,{count:80})):(a.config=j.extend({},b.CONFIG,{settingid:a.settingid,message_skin:a.defaultSkin[b.CONFIG.message_skin]||b.CONFIG.message_skin}),a.config.service=p.protocolFilter(a.config.service),
a.config.enterprise=p.protocolFilter(a.config.enterprise),c=a._initTab(),a.changeSkin(a.config.message_skin),a._switchTab(c),a.switchUI(2),a.initButtons(),a.sendNumEnable=a.config.send_msgnum_enable||a.sendNumEnable,a.config.enableevaluation=a.config.enterprise.enableevaluation||a.config.enableevaluation,a.getCustomerServiceInfo(a.destid,a.single)):a.switchUI(0,0,b.utils.handleLinks(i.load_failure,{count:75}))}))},_initTab:function(){h.Log(this.settingid+":chat._initTab()");if(!b.B.MOBILE){this.tagElement=
f(".ntkf-chat-tags ul",this.element);this.itemElement=f("iframe.ntkf-chat-iteminfo",this.element);this.faqElement=f(".ntkf-chat-faqlist ol",this.element);this.aboutusElement=f("div.ntkf-chat-aboutus",this.element);var a=this,e="about:blank",e="",c=0,d=RegExp("[tabs+(.*?)](.*?)[/tab]",t),g=[],l,z=["ntkf-chat-iteminfo","ntkf-chat-faqlist","ntkf-chat-aboutus"];f("li",this.tagElement).remove();e=this.config.labeltext?this.config.labeltext.split(","):i.labeltext.split(",");l=(this.config.tab_order||"0,1,2").split(",");
for(var t=l.length-1;0<=t;t--)g.push(l[t]);for(t=0;t<g.length;t++)l=g[t],t==g.length-1&&(c=l),f({tagName:"LI",className:z[l],style:"background:none;border:1px solid #ccc;border-bottom:0;display:block;float:left;list-style:none;margin:0 0 0 2px;_margin:0 0 0 1px;padding:0;width:52px;height:auto;"},this.tagElement).html('<span _curIndex="'+l+'" style="cursor:pointer;background:none;display:block;width:52px;height:23px;text-align:center;font:normal 12px/24px SimSun;color:#5a5a5a;margin:0;padding:0;z-index:9;overflow:hidden;">'+
e[l]+"</span>");this.itemdata?(e=b.url_mcenter+"goodsinfo/index.php?"+j.toURI({siteid:this.siteid,itemdata:p.decToHex(r.toJSONString(this.itemdata)),charset:b.charset,type:1}),this.itemElement.attr("src",e)):this.itemid?(e=b.url_mcenter+"shopiteminfo/iteminfo.php?"+j.toURI({siteid:this.siteid,itemid:this.itemid,itemparam:this.itemparam,user_id:b.user.shortID,type:1}),this.itemElement.attr("src",e)):(f("li.ntkf-chat-iteminfo",this.tagElement).hide(),this.itemElement.hide());if(b.isDefined(this.config.faqlist)&&
0<this.config.faqlist.length){if(e=this.config.faqlist,0==f("li",this.faqElement).length)for(t=0;t<e.length;t++)f({tagName:"li",title:e[t].con.replace(/<.*?>/gi,""),alt:e[t].con},this.faqElement).html(e[t].title).bind("click",function(b,c){a.showMessage({type:12,title:c.innerHTML,msg:f(c).attr("alt")})}).hover(function(a,b){f(b).css("text-decoration","underline")},function(a,b){f(b).css("text-decoration","none")}).cssText("list-style:disc inside none;cursor:pointer;margin:0;padding:0;border:0;font:normal 12px/24px Arial,SimSun;color:#5a5a5a;text-align:left;float:none;width:"+
(n.IE7||n.IE6?"auto":"100%")+";")}else f("li.ntkf-chat-faqlist",this.tagElement).hide(),this.faqElement.hide();b.isDefined(this.config.enterprise)&&(e=this.config.enterprise.introduction||"",d.test(e)?(e=e.replace(/^\[tab\s+(.*?)\](.*?)\[\/tab\]$/gi,"<iframe class='ntkf-aboutus-content' name='ntkf-iframe-aboutus' src='$1' width='100%' height='334' scrolling='no' frameborder='0' marginwidth='0'></iframe>"),e=b.utils.handleLinks(e,{siteid:b.siteid,user_id:b.user.shortID,itemid:this.itemid,itemparam:this.itemparam}),
f(".ntkf-aboutus-content",this.element).parent().css("height","334px").html(e)):f(".ntkf-aboutus-content",this.element).html(e));this.itemElement.attr("height",this.style.body.height-this.style.tag.height);f("div.ntkf-chat-aboutus,div.ntkf-chat-faqlist,iframe.ntkf-chat-iteminfo",this.element).css("height",this.style.body.height-32+"px");f("li span",this.tagElement).bind("click",function(b,c){a._switchTab(f(c).attr("_curIndex"))});return c}},_switchTab:function(a){var a=parseInt(a||0),b=["ntkf-chat-iteminfo",
"ntkf-chat-faqlist","ntkf-chat-aboutus"];f("li span",this.tagElement).css("height","23px").gradient("top",this.skin.gradient0,this.skin.gradient1);f("li",this.tagElement).css("border-color",this.skin.tabNoSelectBorder).removeClass("selected");for(f("div.ntkf-chat-aboutus,iframe.ntkf-chat-iteminfo,div.ntkf-chat-faqlist",this.element).each(function(a){f(a).hide()});"none"==f("li."+b[a],this.tagElement).css("display");)a++;this.selectTag=f("li."+b[a],this.tagElement).css("border-color",this.skin.borderColor).addClass("selected");
f("span",this.selectTag).css("height","24px").gradient("top","#d4d4d4","#ffffff");f("div."+b[a]+",iframe."+b[a],this.element).show()},_initComment:function(){var a=this,e=this.config.form_announcement||this.config.announcement||"",c='<table cellspacing="0" cellpadding="0" border="0" style="margin:0;padding:0;border:0;width:100%;background:transparent;"><tbody style="margin:0;padding:0;border:0;font:normal 0/0 Arial,SimSun;">',d=function(){var c=f("form.ntkf-message-form",a.element).first();c.action=
b.url_mcenter+"queryservice.php?m=Index&a=queryService&t=leaveMsg&siteid="+a.sellerid;c.submit();f("form.ntkf-message-form input[type=text], form.ntkf-message-form textarea",a.element).attr("disabled",!0);f("form.ntkf-message-form input[type=button]",a.element).hide();f("form.ntkf-message-form span.submit_message_complete",a.element).show()};if(1===(b.B.MOBILE?1:this.config.disable_message||0))c=c+('<tr><td style="margin:0;padding:0 0 0 15px;border:0;font:normal 12px/160% Arial,SimSun;color:#333;vertical-align:top;">'+
e+"</td></tr>")+"</tbody></table>",f(".ntkf-comment-form-table").html(c);else{if(!this.config.form_message||"string"==typeof this.config.form_message||!this.config.form_message.length)this.config.form_message=this.config.message_form;if(!this.config.form_message||"string"==typeof this.config.form_message||!this.config.form_message.length)this.config.form_message=i.default_message_form_fields;for(var g=0;g<this.config.form_message.length;g++)this.config.form_message[g]=j.extend(this.config.form_message[g],
{titlewidth:/zh_cn|en_us/ig.test(i.language)?"80px":"140px",inputwidth:"auto",input:{width:"90%",height:"textarea"==this.config.form_message[g].type?"140px":"auto"},messageid:"NEWS_"+this.config.form_message[g].name});c+=b.FORM.createInput(this.config.form_message,{id:"ntkf-announcement",rowspan:5,style:"margin:0;padding:0 0 0 15px;border:0;width:120px;font:normal 12px/160% Arial,SimSun;color:#333;vertical-align:top;"});c+='<tr style="margin:0;padding:0;border:0;"><td style="margin:0;padding:0;border:0;"></td><td style="text-align:left;padding:20px 0px 0px;margin:0;border:0;color:#090;font:normal 12px/160% Arial,SimSun;"><input type="button" class="ntkf-button ntkf-submit-comment" value="'+
i.go_message+'" style="margin:0;padding:0 10px;border:0;font:normal 12px/24px Arial,SimSun;color:#fff;width:auto;height:24px;"><span class="submit_message_complete" style="text-align:left;padding:0px;margin:0;border:0;color:#090;font:normal 12px/160% Arial,SimSun;display:none;">'+i.message_success+"</span></td></tr>";c+="</tbody></table>";f(".ntkf-comment-form-table",this.element).html(c);f("#ntkf-announcement",this.element).html(e);this.dest.id=this._getDest(!1);f("input[name=myuid]",this.element).value(this.user.id);
f("input[name=destuid]",this.element).value(this.dest.id);f("input[name=ntkf_t2d_sid]",this.element).value(this.dest.sid);f("form.ntkf-message-form input[type=text], form.ntkf-message-form textarea").css("color","#ccc").attr("disabled","");f("form.ntkf-message-form input[type=button]").show();f("form.ntkf-message-form span.submit_message_complete").hide();b.FORM.bindFormEvent(this.config.form_message,this.element);f(".ntkf-submit-comment",this.element).css("background-color",this.skin.bgColor).bind("click",
function(){""==f("input[name=destuid]",a.element).get(0).value&&h.Log("Unallocated Service",2);b.FORM.verificationForm(a.config.form_message,d,this.element)})}},_picturesOnLoad:function(a,e,c){var d;c.width>this.maxContentWidth&&(d=this.maxContentWidth/c.width,c.height*=d,c.width=this.maxContentWidth,h.Log("width:"+c.width+", height:"+c.height+", ::"+d));e&&(element=b.E.fixEvent(a).target,f(element.parentNode.parentNode).css("display","block"),h.Log("ie8 reset style display:inline-block"))},_pictureAbnormal:function(a,
e){var c=a||b.E.fixEvent(e).target;c&&(c.onerror=null,c.src="ablout:blank")},_showFace:function(a){var e=this,c,d;c=n.IE6?".gif":".png";d=this.face.html();if(""!=d)if(c="block"==this.face.css("display")?"hide":"show",d=f(".ntkf-chat-historyarea",this.element).rect(),b.B.MOBILE)this.face[c]();else this.face.css({left:a+"px",top:d.height-99+"px"})[c]();else{for(var g in i.editorFaceAlt)"string"==typeof i.editorFaceAlt[g]&&(d+='<img title="'+i.editorFaceAlt[g]+'" src="'+this.url_image+"/faces/"+g+c+
'" style="border:1px solid #DFEFF8;outline:0;diplay:block;float:left;background:none;margin:0;padding:3px;width:23px;height:23px;display:inline;"/>');d+='<span style="clear:both;font:0px/0px Arial;height:0px;margin:0;padding:0;" />';b.B.MOBILE||this.face.css("left",a+"px");this.face.html(d).show();f("img",this.face).hover(function(a,c){b.E.fixEvent(a).stopPropagation();f(c).css({cursor:"pointer","border-color":"#4EB4EC"})},function(a,c){b.E.fixEvent(a).stopPropagation();f(c).css("border-color","#DFEFF8")}).bind("click",
function(a,c){b.E.fixEvent(a).stopPropagation();e.face.hide();e._insertText("["+f(c).attr("title")+"]")})}},_insertText:function(a){var b,c=this.editor.value()||"",d=this.editor.first();d.selectionEnd?(b=d.selectionEnd||c.length,this.editor.value(c.substr(0,b)+a+c.substr(b,c.length))):this.editor.value(c+a);n.MOBILE||d.focus()},_filterFace:function(a){var b=n.IE6?".gif":".png";if(a){var c=0,d=a.match(/\[(.+?)\]/ig);if(!d)return a;for(var g=0;g<d.length;g++){a:{c=void 0;for(c in i.allEditorFaceAlt)if("function"!=
typeof i.allEditorFaceAlt[c]&&i.allEditorFaceAlt[c]&&d[g]=="["+i.allEditorFaceAlt[c]+"]")break a;c=1}a=a.replace(d[g],d[g].replace(/\[(.+?)\]/i,'<img title="$1" src="'+this.url_image+"/faces/"+c+b+'" style="width:23px;height:23px;margin:0 2px;padding:0;display:inline;vertical-align:text-bottom" />'))}return a}return""},_bindEvent:function(){this.historyUL=f(".ntkf-chat-historyarea ul",this.element);this.buttons=f(".ntkf-chat-toolbar .ntkf-button-over",this.element);this.editor=f(".ntkf-chat-editor",
this.element);this.submit=f(".ntkf-button-submit",this.element);this.face=f(".ntkf-chat-face",this.element);this.error=f(".ntkf-chat-loadingtext",this.element);var a=this,e=["#ffffff","#e9e9e9"];this.buttons.each(function(b){a.enableButtons.add(b.parentNode.className,{enable:null})});this.buttons.hover(function(c,d){a.enableButtons.items(d.parentNode.className).enable&&!b.B.MOBILE&&(b.isArray(e)&&2==e.length?f(d).css("border-color","#c2c1c1").gradient("top",e[0],e[1]):f(d).css({"border-color":"#c2c1c1",
"background-color":e}))},function(c,d){a.enableButtons.items(d.parentNode.className).enable&&!b.B.MOBILE&&(b.isArray("#F3F3F3"),f(d).css("border-color","#F3F3F3").gradient(!1),n.IE&&f(d).css("filter","none"))}).bind("click",function(c,d){if(a.enableButtons.items(d.parentNode.className).enable){b.E.fixEvent(c).stopPropagation();var e=d.parentNode,f=a.callback.isExpand();switch(e.className){case "ntkf-icon-face":e=(f?a.style.chatToolbar.width:0)+2;a._showFace(e);break;case "ntkf-icon-record":window.open(b.url_mcenter+
"historymessage.php?"+j.toURI({m:"Msg",a:"downloadMsg",uid:a.user.id,sid:a.dest.sid,lang:b.Lang.language,tzo:(new Date).getTimezoneOffset()/60}));h.Log("download record file");break;case "ntkf-icon-evaluation":a.showSubmitEvaluation();break;case "ntkf-icon-captureImage":b.captureImage.initialize(function(b){a.captureImageCallBack(b)},function(b){a.captureImageDownload(b)})}}});this.editor.bind("click",function(c){b.promptwindow.stopPrompt();a.face.hide();b.E.fixEvent(c).stopPropagation()});f(y).bind("click",
function(){b.promptwindow.stopPrompt();a.face.hide()});b.B.MOBILE&&a.editor.bind("keyup",function(c,d){d.value=b.S.cut(d.value,a.inputMaxByte/2)});this.keypressTimer=setInterval(function(){var c=a.editor.value()||"",d=a.__listen;b.S.len(c)>a.inputMaxByte&&(c=b.S.cut(c,a.inputMaxByte/2),a.editor.value(c),a.editor.first().scrollTop=80);b.B.MOBILE&&(c=b.S.cut(c,25),c=c.replace(/^\s+|\s+$/i,""));(c&&d!=c||!c&&d)&&a.Flash&&a.Flash.predictMessage&&a.connected&&a.Flash.predictMessage(c);a.__listen=c},2E3);
this.editor.bind("keypress",function(c){c=b.E.fixEvent(c);c.stopPropagation();b.promptwindow&&b.promptwindow.stopPrompt();13==c.keyCode&&c.ctrlKey||10==c.keyCode?a.editor.first().value+="\r\n ":!(13==c.keyCode&&c.shiftKey)&&13==c.keyCode&&(c.preventDefault(),a.enable&&a.send())});this.submit.bind("click",function(){a.enable&&a.send()});a.toolbar.bind("mouseover",function(){f(".ntkf-chat-bar-close",a.toolbar).css("background-position","-13px -217px")}).bind("mouseout",function(){f(".ntkf-chat-bar-close",
a.toolbar).css("background-position","-25px -219px")}).bind("click",function(){a.callback.switchChat.call(a,a.settingid);a.stopFlicker()});f(".ntkf-chat-bar-close",a.toolbar).bind("click",function(c){b.E.fixEvent(c).stopPropagation();a.close()})},_create:function(){var a;a=[['<div style="margin:0;padding:0;border-top:1px solid #c6c6c6;outline:0px;width:100%;height:51px;background:#F0F0F0;bottom:0;"><div class="ntkf-chat-toolbar" style="margin:0;padding:0;border-top:1px solid #fff;width:100%;height:50px;"><div class="ntkf-icon-face" style="margin:8px 0 12px 10px;padding:0;border:0;width:auto;height:30px;display:inline-block;background:none;float:left;"><span class="ntkf-button-over" style="width:auto;height:30px;margin:0;padding:0;border:0;color:#5a5a5a;cursor:pointer;display:inline-block;font:12px/18px Arial,SimSun;">',
'<span style="border:0;width:auto;height:30px;margin:0;padding:0 0 0 30px;font:normal 12px/18px Arial,SimSun;color:#5a5a5a;display:inline-block;background:url('+this.url_mobile_image+') no-repeat scroll 0px -155px;cursor:pointer;"></span>','</span><div style="clear:both;font:0/0px Arial;height:0;margin:0;padding:0;display:inline;"></div><div class="ntkf-chat-face" style="width:310px;height:124px;position:fixed;left:1px;bottom:50px;background:#FFFFFF;border:1px solid gray;display:none;text-align:left;margin:0;padding:5px;z-index:1000002;"></div></div><div class="ntkf-icon-evaluation" style="margin:8px 0 12px 4px;padding:0;border:0;width:auto;height:30px;display:inline-block;background:none;float:left;"><span class="ntkf-button-over" style="width:auto;height:30px;margin:0;padding:0;border:0;color:#5a5a5a;cursor:pointer;display:inline-block;font:12px/18px Arial,SimSun;">',
'<span style="border:0;width:auto;height:30px;margin:0;padding:0 0 0 30px;font:normal 12px/18px Arial,SimSun;color:#5a5a5a;display:inline-block;background:url('+this.url_mobile_image+') no-repeat scroll 0px -190px;cursor:pointer;"></span>',"</span></div>",'<div class="ntkf-button-submit" style="margin:8px 8px 8px 0;padding:0;border:0;width:62px;height:31px;background:url('+this.url_mobile_image+') no-repeat 0 -45px;float:right;cursor:pointer;text-align:center;font:normal 16px/30px Arial;">'+i.chat_button_send+
"</div>",'<div class="ntkf-chat-editor-arear" style="margin:7px 78px;padding:0;border:0;display:block;height:auto;">','<input class="ntkf-chat-editor" maxlength="'+this.inputMaxByte+'" style="margin:2px 0;padding:0;border:1px solid #A2A2A2;height:27px;width:100%;-moz-border-radius:5px;-webkit-border-radius:5px;border-radius:5px;display:inline-block;" type="text" autofocus="true" autocomplete="off" x-webkit-speech  x-webkit-grammar="builtin:translate" />',"</div></div></div>"].join(""),['<div class="ntkf-chat-toolbar" style="width:100%;height:26px;margin:0;padding:0;border-top:1px solid #d4d3d3;border-bottom:1px solid #d4d3d3;font:normal normal normal 12px/26px Arial,SimSun;color:#000000;text-align:left;background:#F3F3F3;"><div class="ntkf-icon-face" style="float:left;width:auto;height:26px;font:normal 12px/26px;margin:0 0 0 2px;padding:0;border:0;display:inline;overflow:visible;"><span class="ntkf-button-over" style="width:auto;height:20px;margin:2px 0;padding:0;border:1px solid #F3F3F3;color:#5a5a5a;cursor:pointer;display:inline-block;font:12px/18px Arial,SimSun;">',
'<span style="border:0;width:auto;height:18px;margin:1px 0 0 0;padding:0 2px 0 20px;font:normal 12px/18px Arial,SimSun;color:#5a5a5a;display:inline-block;background:url('+this.url_chat_image+') no-repeat scroll 1px 1px;cursor:pointer;">'+i.button_face+"</span>","</span>",!n.IE6?'<div style="clear:both;font:0/0px Arial;height:0;margin:0;padding:0;display:inline;"></div>':"",'<div class="ntkf-chat-face" style="width:310px;height:124px;position:absolute;left:1px;top:'+(this.style.body.history.height-
99)+'px;background:#FFFFFF;border:1px solid gray;display:none;text-align:left;margin:0;padding:5px;z-index:1000002;"></div>','</div><div class="ntkf-icon-image" style="float:left;width:auto;height:26px;font:normal 12px/26px;margin:0 0 0 2px;padding:0;border:0;display:inline;overflow:visible;"><span class="ntkf-button-over" style="width:auto;height:16px;margin:2px 0;padding:2px 1px;border:1px solid #F3F3F3;color:#5a5a5a;cursor:pointer;display:inline-block;font:12px/18px Arial,SimSun;"></span></div><div class="ntkf-icon-file" style="float:left;width:auto;height:26px;font:normal 12px/26px;margin:0 0 0 2px;padding:0;border:0;display:inline;overflow:visible;"><span class="ntkf-button-over" style="width:auto;height:16px;margin:2px 0;padding:2px 1px;border:1px solid #F3F3F3;color:#5a5a5a;cursor:pointer;display:inline-block;font:12px/18px Arial,SimSun;"></span></div><div class="ntkf-icon-record" style="float:left;width:auto;height:26px;font:normal 12px/26px;margin:0 0 0 2px;padding:0;border:0;display:inline;overflow:visible;"><span class="ntkf-button-over" style="width:auto;height:20px;margin:2px 0;padding:0;border:1px solid #F3F3F3;color:#5a5a5a;cursor:pointer;display:inline-block;font:12px/18px Arial,SimSun;">',
'<span style="border:0;width:auto;height:18px;margin:1px 0 0 0;padding:0 2px 0 20px;font:normal 12px/18px Arial,SimSun;color:#5a5a5a;display:inline-block;background:url('+this.url_chat_image+') no-repeat scroll 1px -89px;cursor:pointer;">'+i.button_save+"</span>",'</span></div><div class="ntkf-icon-captureImage" style="float:left;width:auto;height:26px;font:normal 12px/26px;margin:0 0 0 2px;padding:0;border:0;display:inline;overflow:visible;"><span class="ntkf-button-over" style="width:auto;height:20px;margin:2px 0;padding:0;border:1px solid #F3F3F3;color:#5a5a5a;cursor:pointer;display:inline-block;font:12px/18px Arial,SimSun;">',
'<span style="border:0;width:auto;height:18px;margin:1px 0 0 0;padding:0 2px 0 20px;font:normal 12px/18px Arial,SimSun;color:#5a5a5a;display:inline-block;background:url('+this.url_chat_image+') no-repeat scroll -49px -259px;cursor:pointer;">'+i.button_captureImage+"</span>",'</span></div><div class="ntkf-icon-evaluation" style="float:right;width:auto;height:26px;font:normal 12px/26px;margin:0 2px 0 0;padding:0;border:0;display:inline;overflow:visible;"><span class="ntkf-button-over" style="width:auto;height:20px;margin:2px 0;padding:0;border:1px solid #F3F3F3;color:#5a5a5a;cursor:pointer;display:inline-block;font:12px/18px Arial,SimSun;">',
'<span style="border:0;width:auto;height:18px;margin:1px 0 0 0;padding:0 2px 0 20px;font:normal 12px/18px Arial,SimSun;color:#5a5a5a;display:inline-block;background:url('+this.url_chat_image+') no-repeat scroll 1px -148px;cursor:pointer;">'+i.button_evaluation+"</span>",'</span></div></div><div style="clear:both;font:normal 0px/0px;height:0px;margin:0;padding:0;border:0;"></div><div class="ntkf-chat-editor-arear" style="overflow:hidden;width:100%;height:47px;margin:0;padding:0;"><textarea class="ntkf-chat-editor" style="margin:0;outline:0;padding:3px 2%;width:96%;height:41px;background:#fff;border:0;display:block;color:#000;font:normal 12px/14px Arial,SimSun;text-align:left;word-wrap:break-word;overflow-y:hidden;overflow-x:auto;"></textarea></div><div style="background:#f3f3f3;border:0;border-top:1px solid #d4d3d3;height:22px;*height:21px !important;margin:0;padding:0;">',
'<div class="ntkf_input_state" style="margin:0;padding:0 0 0 10px;border:0;display:none;font:normal 12px/22px Arial,SimSun;float:left;text-align:left;color:#5a5a5a;">'+i.input_state+"</div>",'<span class="ntkf-button-submit" style="background:#ccc;border:0 none;color:#fff;cursor:pointer;float:right;width:auto;height:22px;font:normal 12px/22px Arial,SimSun;margin:0;padding:0 10px;text-align:center;">'+i.chat_button_send+"</span>","</div>"].join("")];a=['<div class="ntkf-chat-child-online" style="display:none;margin:0;padding:0;border:0;">',
'<div class="ntkf-chat-child-left" style="background:#fff;float:left;height:'+this.style.body.height+"px;width:"+this.style.body.left.width+'px;margin:0;padding:0;border:0;overflow:visible;border-right:1px solid #fff;">','<div class="ntkf-chat-historyarea" style="height:'+this.style.body.history.height+"px;overflow-x:hidden;overflow-y:scroll;padding:0;margin:0;width:100%;border:0 none;color:#000000;font:normal 12px/160% Arial,SimSun;text-align:left;position:relative;background:"+(b.B.MOBILE?"#EEE":
"#FFF")+'">','<ul style="list-style:none;margin:10px 15px;padding:0;text-align:left;"><li style="list-style:none;margin:0;padding:0;font:0px/0px Arial;"></li></ul></div>',b.B.MOBILE?a[0]:a[1],"</div>",b.B.MOBILE?"":['<div class="ntkf-chat-child-right" style="'+(b.B.MOBILE?"display:none;":"")+"position:relative;background:none;"+(n.IE6?"width:168px;padding:0;margin:0 0 0 -1px;":"float:right;width:172px;padding:0;margin:0 0 0 -1px;")+"height:"+(this.style.height-this.style.header.height)+'px;overflow:hidden;text-align:left;z-index:0;">',
'<div class="ntkf-chat-tags" style="overflow:visible;position:absolute;left:0;top:0;width:100%;height:24px;margin:7px 0 0;padding:0;border:0;z-index:0;"><ul style="list-style:none;margin:0;padding:0;"></ul></div><div class="ntkf_tab_container" style="position:absolute;left:0;top:31px;border:0;border-top:1px solid #ccc;background:#fff;margin:0;padding:0;width:100%;height:auto;z-index:-1;"><iframe class="ntkf-chat-iteminfo" style="background:#fff;margin:0;padding:0;border:0;display:none;width:170px;height:auto;" src="about:blank" width="170" height="100%" scrolling="no" frameborder="0" marginwidth="0" marginheight="0"></iframe><div class="ntkf-chat-faqlist" style="background:#fff;margin:0;padding:0;border:0;display:none;width:100%;height:auto;overflow-x:hidden;overflow-y:auto;"><ol style="list-style:none;margin:0;padding:0 0 0 8px;border:0;"></ol></div><div class="ntkf-chat-aboutus" style="background:#fff;margin:0;padding:0;border:0;display:none;width:100%;height:auto;overflow-x:hidden;overflow-y:auto;"><div style="margin:0;padding:0px;border:0;color:#000;font:normal 12px/160% SimSun;text-align:left;height:auto;display:block;"><div class="ntkf-aboutus-content" style="margin:0;padding:0;border:0;width:100%;height:auto;table-layout:fixed;word-break:break-all;color:#5a5a5a;font:normal 12px/160% Arial,SimSun;text-align:left;"></div></div></div></div></div>'].join(""),
'</div><div class="ntkf-chat-child-offline" style="border:0;margin:0;padding:0;width:100%;height:auto;display:none;"><iframe style="width:1px;height:1px;margin:0;padding:0;border:none;position:absolute;top:-200px;" src="about:blank" name="submitMsgIframe"></iframe><form name="ntkf-comment-form" action="" enctype="multipart/form-data" target="submitMsgIframe" method="post" class="ntkf-message-form" style="margin:20px 20px 0 20px;padding:0;display:block;">','<input type="hidden" value="'+b.charset+
'" name="charset" /><input type="hidden" value="'+b.url_source+'" name="parentpageurl" />','<input type="hidden" value="" name="myuid" /><input type="hidden" value="" name="destuid" /><input type="hidden" value="" name="ntkf_t2d_sid" /><input type="hidden" value="" name="source" /><div class="ntkf-comment-form-table" style="margin:0;padding:0;border:0;width:100%;height:325px;overflow:hidden;"></div></form></div><div class="ntkf-chat-child-load" style="display:block;margin:0;padding:0;border:0;float:none;width:100%;height:auto;"><div class="ntkf-chat-loadingtext" style="margin:120px 20px 20px;padding:0;border:0;float:none;height:36px;font:bold 22px/36px Arial,SimSun;text-align:center;color:#5a5a5a;"></div>',
'<div style="text-align:center;margin:0;padding:0;font:normal 12px/160% Arial,SimSun;float:none;"> <a href="javascript:void(0);" onclick="NTKF.chatManage.close(\''+this.settingid+'\')" style="margin:20px;padding:0;border:0;color:#0a8cd2;font:normal 12px/160% Arial,SimSun;text-decoration:none;">'+i.chat_close_text+"</a></div>",'</div><iframe class="ntkf-alert-iframe" style="display:none;position:absolute;left:0;top:0;margin:0;padding:0;border:0;width:518px;height:406px;-moz-opacity:0;opacity:0;filter:alpha(opacity=0);z-index:88888;border:none;"></iframe><div class="ntkf-alert-background" style="display:none;position:absolute;left:0;top:0;margin:0;padding:0;border:0;width:518px;height:406px;background:#000;-moz-opacity:0.35;opacity:0.35;filter:alpha(opacity=35);z-index:99999;border:none;"></div><div class="ntkf-alert-container" style="display:none;-moz-border-radius:5px;-webkit-border-radius:5px;border-radius:5px;position:absolute;left:100px;top:70px;width:300px;height:260px;-moz-opacity:1;opacity:1;filter:alpha(opacity=100);border:1px solid #ccc;z-index:2147483647;margin:0;padding:1px;font:normal 12px/160% Arial,SimSun;background:#fff;"></div>'].join("");
this.element=f({className:"ntkf-chat-child",id:this.id,style:"overflow:hidden;margin:0;padding:0;border:0;float:none;"},f("#ntkf_chat_content"),f("#ntkf_chat_load").first()).html(a);this.area=f(".ntkf-chat-historyarea",this.element).get(0);this.inputstate=f(".ntkf_input_state",this.element)},_createFlash:function(a,e,c,d){var g=b.url_resource+"/fs/FileUpload"+(!/^zh_cn$/ig.test(i.language)?"_"+i.language:"")+".swf?"+j.toURI({action:c,version:b.version_upload}),c=j.toURI({action:c,siteid:this.siteid,
settingid:this.settingid,roomid:"T2D"}),d=[['<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="'+b.protocol+'//download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,28" ',' alt="'+d+'" id="'+e+'" name="'+e+'" width="41" height="16" style="margin:0;padding:0;"> ','<param name="movie" value="'+g+"&rnd="+b.createTimeID()+'" /> ','<param name="wmode" value="transparent" /><param name="allowscriptaccess" value="always" />','<param name="flashvars" value="'+c+'" />',
"</object>"].join(""),['<object id="'+e+'"  name="'+e+'" type="application/x-shockwave-flash" data="'+g+"&rnd="+b.createTimeID()+'" width="41" height="16">','<param name="movie" value="'+g+"&rnd="+b.createTimeID()+'"/>','<param name="quality" value="high"/><param name="allowscriptaccess" value="always"/>','<param name="flashvars" value="'+c+'" /> ',"</object>"].join(""),['<embed alt="'+d+'" src="'+g+'" id="'+e+'" name="'+e+'" wmode="transparent" width="41" height="16" flashvars="'+c+'" allowscriptaccess="always" pluginspage="'+
b.protocol+'//www.macromedia.com/go/getflashplayer" type="application/x-shockwave-flash" style="margin:0;padding:0;" >',"</embed>"].join("")];f("."+a+" span",this.element).insert(n.IE&&11>n.IE_VER?d[0]:n.IE&&11<=n.IE_VER?d[1]:d[2]);return f("#"+e,this.element).first()},_createToolbar:function(a,b){h.Log(this.settingid+":chat._createToolbar()");var c=['<span class="ntkf-chat-bar-close" style="margin:0;padding:0;border:0;display:block;width:15px;height:15px;position:absolute;left:105px;top:4px;background:url('+
this.url_chat_image+') no-repeat scroll -25px -219px;"></span>','<span class="ntkf-chat-bar-head" style="margin:8px 5px 8px 5px;padding:0;float:left;width:7px;height:7px;display:block;border:1px solid #0067CC;"></span>','<span class="ntkf-chat-bar-name" style="margin:0;padding:0;float:left;font:normal 12px/23px Microsoft YaHei,Arial,SimSun;width:85px;height:24px;overflow:hidden;">'+i.toolbar_default_text+"</span>"].join("");a.length&&(this.toolbar=f({id:b,tagName:"LI",className:"selected",style:"list-style:none;margin:0 0 5px 0;padding:0;width:100%;height:23px;cursor:pointer;position:relative;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;background-color:#fff;color:#000;"},
a,a.first().lastChild).html(c),this.header=f(".ntkf-chat-bar-head",this.toolbar),this.offline())},_closeToolbar:function(){this.toolbar.remove()},_skinColor:function(a){var e=b.Color.toHSL(this.baseColor),c=b.Color.toRGB(this.baseColor),a=c.r==c.g&&c.r==c.b?this.hslColorDifference.restoreColor[a]||this.hslColorDifference.restoreColor.bgColor:this.hslColorDifference.color[a]||this.hslColorDifference.color.bgColor,e=b.Color.toRGB({h:e.h-a.h,s:e.s-a.s,l:e.l-a.l});return b.Color.toHex(e)},_viewImage:function(a){if(a){var e=
this,c=f(a).attr("sourceurl"),d=Math.max(y.body.scrollHeight,y.documentElement.scrollHeight),g=function(a){a=b.E.fixEvent(a);27==a.keyCode&&h()},h=function(){f("#ntkf_view_image").hide(!0,!0);b.E.removeEvent(y,"keypress",g)};this.preview=f("#ntkf_view_image");c=c?c:a.src;a=['<div class="ntkf-view-bg-opacity" style="margin:0;padding:0;border:0;background:#000;opacity:0.6;filter:alpha(opacity=60);width:100%;height:'+d+'px;position:absolute;top:0;left:0;z-index:21474836;"></div>','<div class="ntkf-view-image" style="margin:0;padding:0;border:0;width:100%;height:100%;border:0;text-align:center;position:absolute;top:0px;left:0;z-index:2147483647;"><table style="margin:auto;padding:0;border:0;width:100%;height:100%;background:transparent;"><tr><td valign="middle" align="center" style="margin:0;padding:0;border:0;vertical-align:middle;"><img style="margin:0 auto;padding:0;" /></td></tr></table>',
'<span class="ntkf-view-image-close" style="position:absolute;width:22px;height:22px;border:0 solid #ccc;color:#ccc;margin:20px 20px 0 0;padding:3px;top:0;right:0;cursor:pointer;background:url('+this.url_chat_image+') no-repeat scroll 1px -462px;z-index:2147483647;"></span>','<span class="ntkf-view-image-save" style="position:absolute;width:22px;height:22px;border:0 solid #ccc;color:#ccc;margin:20px 20px 0 0;padding:3px;top:0;right:50px;cursor:pointer;background:url('+this.url_chat_image+') no-repeat scroll 1px -428px;z-index:2147483647;"></span>',
"</div>"].join("");this.preview.length&&this.preview.remove();this.preview=f({id:"ntkf_view_image",style:"margin:0;padding:0;border:0;width:100%;height:100%;border:0;text-align:center;position:absolute;top:0;left:0;z-index:2147483647;"}).html(a).css("height",b.bodyOffset.viewH+"px").show(!0);f("#ntkf_view_image,.ntkf-view-image-close").bind("click",h);f("#ntkf_view_image .ntkf-view-image-save").bind("click",function(a){b.E.fixEvent(a).stopPropagation();(a=f("#ntkf_view_image img").first())&&w.open(a.src);
f("#ntkf_view_image").remove()});A.addEvent(y,"keypress",g);x.load(c+"#image",function(a,c){if("complete"==a.status){var d=c.width>b.bodyOffset.width?b.bodyOffset.width-100:c.width,e=d/c.width*c.height,g;e>b.bodyOffset.viewH&&(g=e,e=b.bodyOffset.viewH,d=parseInt(e/g*d));f(".ntkf-view-image img").attr({src:c.src,width:d,height:e})}else f(".ntkf-view-image img").attr({src:c.src})});this.lockpreview=new b.lockPosition(this.preview,{debug:!0,resize:!1,top:0,left:0,fixed:!0});A.addEvent(w,"resize",function(){e.preview.css({width:b.bodyOffset.viewW+
"px",height:b.bodyOffset.viewH+"px"});b.bodyOffset.height<b.bodyOffset.viewH&&f(".ntkf-view-bg-opacity").css({height:b.bodyOffset.viewH+"px"})})}},_getDest:function(a){var b=this.config;if(a)return this.single=0,(b.icon||b.list||b.toolbar||b.featureset).members.groupID;if(this.dest.id&&-1==this.dest.id.indexOf("GT2D"))return this.dest.id;this.dest.id="";this.dest.name="";this.single=1;return(b.icon||b.list||b.toolbar||b.featureset).members.idList[0]},setUser:function(a){this.user=j.extend(this.user,
a);this.dest.sid=this.user.sid||this.dest.sid;this.__jdata=j.extend(this.__jdata,{userid:a.id||"",name:a.name||"",logo:a.logo||""})},setDest:function(a){this.dest=j.extend(this.dest,a);this.dest.title=this._getDestTitle();f(".ntkf-chat-bar-name",this.toolbar).html(this.dest.name);this.selected&&this.callback.setDest.call(this,this.dest,this.skin)},_getDestTitle:function(){return this.dest.name&&"trial"==this.config.mode?i.chat_title_ext+" "+this.dest.name:this.dest.name},_showDialog:function(a,b){var c=
this,d=this.callback.isExpand.call(this),a=a+('<div class="ntkf-alert-close" style="cursor:pointer;margin:0;padding:0;border:0;height:12px;position:absolute;right:5px;top:6px;width:12px;background:url('+this.url_chat_image+') no-repeat scroll 1px -178px;-moz-border-radius:0px;-webkit-border-radius:0px;border-radius:0px;"></div>');this.style.dialog=j.extend(this.style.dialog,{bg:{left:d?this.style.chatToolbar.width:0,top:this.style.header.height}},b);this.style.dialog=j.extend(this.style.dialog,{left:(this.style.width-
this.style.dialog.width)/2+(d?this.style.chatToolbar.width:0),top:this.style.header.height+(this.style.body.height-this.style.dialog.height)/2});f(".ntkf-alert-iframe,.ntkf-alert-background",this.element).css({top:this.style.dialog.bg.top+"px",left:this.style.dialog.bg.left+"px",width:this.style.width+"px",height:this.style.body.height+"px"}).show();f(".ntkf-alert-container",this.element).html(a).css({width:this.style.dialog.width+"px",height:"auto",left:this.style.dialog.left+"px",top:this.style.dialog.top+
"px","border-color":this.style.dialog.borderColor||"#ccc"}).show();this.dialogButton=f(".ntkf-alert-close",this.element).bind("mouseover",function(a,b){f(b).css({"background-color":"#fafafa"})}).bind("mouseout",function(a,b){f(b).css({"background-color":""})}).bind("click",function(){c._hidenDialog()});return f(".ntkf-alert-container",this.element)},_updateDialog:function(){if(this.dialogButton){var a=this.callback.isExpand.call(this);this.style.dialog=j.extend(this.style.dialog,{left:(this.style.width-
this.style.dialog.width)/2+(a?this.style.chatToolbar.width:0),bg:{left:a?this.style.chatToolbar.width:0}});f(".ntkf-alert-iframe,.ntkf-alert-background",this.element).css({left:this.style.dialog.bg.left+"px"});f(".ntkf-alert-container",this.element).css({left:this.style.dialog.left+"px"})}},_hidenDialog:function(){var a=this;f(".ntkf-alert-container",this.element).hide(!0,!1,function(){f(".ntkf-alert-iframe,.ntkf-alert-background",a.element).hide();a.dialogButton=null})},resizeDialog:function(){this.style.dialog=
j.extend(this.style.dialog,{left:(this.style.width-this.style.dialog.width)/2,top:this.style.header.height+(this.style.body.height-this.style.dialog.height)/2});f(".ntkf-alert-iframe,.ntkf-alert-background",this.element).css({width:this.style.width+"px",height:this.style.body.height+"px"});f(".ntkf-alert-container",this.element).css({left:this.style.dialog.left+"px",top:this.style.dialog.top+"px"})}},b.extend({chatManage:{id:"ntkf_chat_windows",toolbarid:"ntkf_chat_minimize_toolbar",element:null,
hash:new b.H,inited:!1,created:!1,hide:!1,precreateHide:!1,chatCount:0,minChatMessageCount:0,expand:!1,curChatWindow:null,disableUp:!0,disableDown:!0,position:null,dest:{id:"",name:"",logo:"",status:0,title:""},skin:{bgColor:""},settingid:"",style:{borderWidth:2,width:518,height:406,left:0,top:0,chatToolbar:{width:130},header:{height:b.B.MOBILE?42:39},chat:{},body:{width:518,height:367,history:{height:269},left:{width:345},right:{width:172}},toolbar:{width:183,height:25,borderWidth:1},toolarea:{height:337,
top:0}},open:function(a,e,c,d,g){h.Log("NTKF.chatManage.open("+r.toJSONString(arguments)+")");var f=this;b.globalConfig.itemid=e||b.globalConfig.itemid;this.url_image=b.imagesResources.url_image;this.url_chat_image=b.imagesResources.url_chat_image;this.url_mobile_image=b.imagesResources.url_mobile_image;b.invite.hide();b.completeManage&&b.completeManage.each(function(a,b){0!=b.promotype&&b.example.close()});this._loadDefaultConfig(function(){!1===a&&(f.precreateHide=!0);b.defaultConfig.position=j.extend(b.defaultConfig.position,
{id:"div.openbutton",top:0,left:-80});f.inited||(f.inited=!0,f._create(),f._bindEvent());!1!==a&&f._openChatWindow(a||b.defaultConfig.settingid,c,d,g)})},_openChatWindow:function(a,e,c,d){var g=this,f=j.extend({},c);f.single=e?1:!c||"undefined"==typeof c.single?0:c.single;0==this.chatCount&&(this.hide=!1,this.element.css({left:this.style.left+"px",top:this.style.top+"px"}).show());(this.hide||!0===this.precreateHide)&&this.maximize();this.hash.items(a)?(h.Log("Re- open the chat window"),this.switchChat(a)):
(1==this.chatCount&&this._frameExpand(!0),this.curChatWindow=new b.Chat({settingid:a,itemid:b.globalConfig.itemid,itemparam:d||b.globalConfig.itemparam,itemdata:b.globalConfig.proinfo,destid:e,params:f,style:this.style,waitSendMessage:b.globalConfig.waitSendMessage,callback:{isExpand:function(){return g.expand},open:function(a){g.hash.each(function(b,c){b!=a&&c.minimize()});1<g.hash.count()||(g.style.chat=j.extend(g.style.chat,{left:g.style.left,top:g.style.top,width:g.style.width,height:g.style.height}))},
close:function(a){var b;g.hash.each(function(c){c==a&&(b=g.hash.remove(c),g.chatCount=g.hash.count(),1==g.chatCount&&g._frameExpand(!1),b&&(g.curChatWindow&&!g.hash.contains(g.curChatWindow.settingid))&&b.maximize())})},max:function(a,b,c){g.setDest(b,c)},switchChat:function(a){g.switchChat(a)},changeSkin:function(a){g.changeSkin(a)},changeStatus:function(){g.changeStatus.apply(g,arguments)},setDest:function(a){g.setDest(a)},flicker:function(a){g.hide&&g.minChatMessageCount++;g.verifyFlicker(a);g.hide&&
g.flicker()}}}),this.hash.add(a,this.curChatWindow),this.chatCount=this.hash.count(),this._verifyScroll(),b.B.MOBILE?this.btnClose.gradient("top","#A0E0FC","#4FB5E5"):b.chat_inpage||this.btnClose.gradient("top",this.curChatWindow.skin.gradient0,this.curChatWindow.skin.gradient1))},close:function(a){if(a&&1<this.hash.count())this.hash.items(a).close();else{var e=this,c=function(){e.setDest({id:"",name:"",logo:"",signature:"",title:"",status:0},null,"clear");e.hash.each(function(a,b){b.close(!0);e.hash.remove(a)});
e.scrollChat&&e.scrollChat.clearAutoUpdatePosition();e.curChatWindow=null;e.hide=!0;b.B.MOBILE||e.element.hide();e._verifyScroll();b.chat_inpage||window.close()||e.changeStatus()};this.curChatWindow&&1==this.curChatWindow.config.enableevaluation&&!this.curChatWindow.submitRating&&this.curChatWindow.sendNum>=this.curChatWindow.sendNumEnable&&this.curChatWindow.connected?this.curChatWindow.showSubmitEvaluation(function(){e.curChatWindow.close(!0);c()}):c()}},changeStatus:function(){b.B.MOBILE&&(this.btnClose.get(0).onclick=
null,this.btnClose.html(i.chat_start_text).bind("click",function(){window.location.reload()}))},maximize:function(){h.Log("NTKF.chatManage.maximize()",1);this.hide=!1;this.minChatMessageCount=0;this.toolbar.hide();this.stopFlicker();this.element.css({left:this.style.chat.left+"px",width:this.style.chat.width+"px",height:this.style.chat.height+"px",visibility:"visible"});this.chatcontainer.attr("visibility","visible");this.hash.each(function(a,b){b.scrollBottom()})},minimize:function(){h.Log("NTKF.chatManage.minimize(),minChatMessageCount:"+
this.minChatMessageCount,1);var a=b.bodyOffset;this.hide=!0;0<this.minChatMessageCount&&this.flicker();this.element.css({left:"-1px",width:"1px",height:"1px",visibility:"hidden"});this.chatcontainer.attr("visibility","hidden");this.style.toolbar=j.extend(this.style.toolbar,{right:0,bottom:0},this.position.min);this.scrollChat&&this.scrollChat.clearAutoUpdatePosition();this.style.toolbar.left=Math.max(0,a.left+a.viewW-this.style.toolbar.width-2*this.style.toolbar.borderWidth-this.style.toolbar.right);
this.style.toolbar.top=Math.max(0,a.viewY+a.viewH-this.style.toolbar.height-2*this.style.toolbar.borderWidth-this.style.toolbar.bottom);this.toolbar.show();this.scrollBar||(this.scrollBar=new b.lockPosition(this.toolbar.first(),{debug:!1,width:this.style.toolbar.width+2,height:this.style.toolbar.height+2,left:this.style.toolbar.left,top:this.style.toolbar.top,fixed:!0}))},get:function(a,b){var c;if(0==this.hash.count())return null;if(a){if(c=this.hash.items(a))return c;if(b){for(a=this.hash.next();this.hash.items(a).dest.id!=
b&&!(c=this.hash.next(),a==c);)a=c;return this.hash.items(a)}}else{if(b){for(a=this.hash.next();this.hash.items(a).dest.id!=b&&!(c=this.hash.next(),a==c);)a=c;return this.hash.items(a)}return this.hash.first()}},switchChat:function(a){var b=this;this.hide&&this.maximize();this.get(a)&&this.hash.each(function(c,d){c===a?(b.curChatWindow=d,d.maximize()):d.minimize()})},changeSkin:function(a){h.Log('chatManage.changeSkin("'+r.toJSONString(a)+'")',1);this.skin=j.extend(this.skin,a);b.B.MOBILE?(this.elementHeader.css({"border-color":"#3F8DCE"}),
f(".ntkf-chat-header-light",this.elementHeader).css({"border-color":"#85CDE7"}).gradient("top","#3FB3D8","#2087AA"),f(".ntkf-chat-toolbar").gradient("top","#88A0BC","#617B9C")):(this.element.css("border-color",this.skin.borderColor),this.toolbar.css("background-color",this.skin.bgColor),f(".ntkf-header-div span",this.elementHeader).css({"background-color":this.skin.bgColor}),this.elementHeader.css({"background-color":this.skin.bgColor,"border-left-color":this.skin.highlightBorder,"border-right-color":this.skin.highlightBorder,
"border-bottom-color":this.skin.shadowBorder}))},setDest:function(a,e,c){var d=this,g=f("img.ntkf-header-icon",this.elementHeader),l=f("img.ntkf-toolbar-icon",d.toolbar);this.dest=j.extend(this.dest,a,{title:a.title||a.name});h.Log("chatManage.setDest(), status:"+this.dest.status+", title:"+this.dest.title+(c?c:""),1);e&&this.changeSkin(e);this.dest.logo?x.load(this.dest.logo,function(a){"complete"==a.status?(h.Log("header icon:"+d.dest.logo),g.css({width:(b.B.MOBILE?38:54)+"px",height:(b.B.MOBILE?
38:54)+"px"}).attr("src",d.dest.logo).show(),l.attr("src",d.dest.logo).show()):("gecko"==n.CORE?g.parent().css("background","url("+d.url_chat_image+") no-repeat scroll 1px -359px "+d.skin.bgColor):g.hide(),l.hide())}):("gecko"==n.CORE?g.parent().css("background","url("+this.url_chat_image+") no-repeat scroll 1px -359px "+this.skin.bgColor):g.hide(),l.hide());f(".ntkf-header-name",this.elementHeader).css("width","auto").attr("title",this.dest.title).html(this.dest.title);f(".ntkf-toolbar-title",this.toolbar).html(this.dest.title);
f(".ntkf-header-sign",this.elementHeader).attr("title",this.dest.signature).html(this.dest.signature);j.extend(this.style.header,{username_width:f(".ntkf-header-name").rect("width")||20});f("li.ntkf-header-sign").css({left:this.style.header.username_width+90+"px",width:this.style.width-this.style.header.username_width-160+"px"})},flicker:function(a,e){var c=this,d="undefined"==typeof e?0:e,g=a?1E3:500;"undefined"==typeof a&&(clearTimeout(this.timeID),this.timeID=null,this.toolbar.css({color:"#fff",
"background-color":this.skin.bgColor}).gradient(!1),f(".ntkf-toolbar-title",this.toolbar).html(b.utils.handleLinks(i.news_min_text,{count:this.minChatMessageCount})));this.toolbar.first()&&(a?this.toolbar.css({color:"#fff","border-color":"#cd7000"}).gradient("top","#fe992e","#e77d09"):this.toolbar.css({color:"#fff","border-color":this.skin.borderColor}).gradient(!1).css("background-color",this.skin.bgColor),7<=d||(this.timeID=setTimeout(function(){d+=1;c.flicker(!a,d)},g)))},stopFlicker:function(){clearTimeout(this.timeID);
this.timeID=null;this.toolbar.css({color:"#fff","background-color":this.skin.bgColor}).gradient(!1);f(".ntkf-toolbar-title",this.toolbar).html(this.dest.title)},verifyFlicker:function(a){this.hash.items(a);var a=this.hash.index(a),b=Math.ceil(this.toolarea.scrollTop()/30);a<b&&this._buttonFlicker("up");a>b+12&&this._buttonFlicker("down")},_pictureAbnormal:function(a,e){var c=a||b.E.fixEvent(e).target;c&&(c.onerror=null,c.src="ablout:blank")},_buttonFlicker:function(a,b,c){var d=this,g=f("#ntkf_chat_toolbars .ntkf-chat-scroll"+
(a||"down")),h="undefined"==typeof c?0:c,c=b?1E3:500;"undefined"==typeof b&&(clearTimeout(this.buttonTimeID),this.buttonTimeID=null,g.css({"background-color":"#d7d7d7"}).removeClass("flash"));if(!0==this.stopButtonFlashing)return this.stopButtonFlashing=!1;if(g.first()&&(b?g.css({"background-color":"#cd7000"}).addClass("flash"):g.css({"background-color":"#d7d7d7"}).removeClass("flash"),!(7<=h)))return this.buttonTimeID=setTimeout(function(){h+=1;d._buttonFlicker(a,!b,h)},c),!0},_stopButtonFlicker:function(a){this.stopButtonFlashing=
!0;this._buttonFlicker(a)},_frameExpand:function(a){a?(this.expand=!0,this.style.left=Math.max(0,this.style.left-this.style.chatToolbar.width),j.extend(this.style.chat,{left:this.style.left,top:this.style.top,width:this.style.width+this.style.chatToolbar.width}),this.element.css({left:this.style.chat.left+"px",width:this.style.chat.width+"px"}),f("#ntkf_chat_toolbars").show()):(this.expand=!1,this.style.left=Math.min(this.style.left+this.style.chatToolbar.width,b.bodyOffset.viewW-this.style.width),
j.extend(this.style.chat,{left:this.style.left,top:this.style.top,width:this.style.width}),this.element.css({left:this.style.chat.left+"px",width:this.style.chat.width+"px"}),f("#ntkf_chat_toolbars").hide());this.scrollChat&&(h.Log("update chat manage position"),this.scrollChat.updateAttributes({left:this.style.chat.left,width:this.style.chat.width}))},_create:function(){h.Log("NTKF.chatManage._create()");var a,e;this.created||(this.created=!0,this.position=b.defaultConfig.position,this.position.id=
this.position.id||this.position.entryid,this.position.element=f(this.position.id),e=['<div id="ntkf-chat-header" style="background:#9BC942;border-top:1px solid #678F12;margin:0;padding:0;float:none;outline:0;width:100%;height:42px;"><div class="ntkf-chat-header-light" style="margin:0;padding:0;float:none;border-top:1px solid #fff;outline:0;width:100%;height:41px;"><div class="ntkf-chat-close" style="margin:5px;padding:0 5px;border:none;float:none;width:89px;height:30px;background:none;float:right;cursor:pointer;display:block;text-align:center;"></div><div style="margin:0 auto;padding:0;border:none;width:auto;text-align:center;float:none;"><div class="ntkf-header-name" style="margin:8px 0 8px 10px;padding:0px;border:none;float:none;font:normal 16px/160% Microsoft YaHei,Arial,SimSun;color:#fff;height:34px;overflow:hidden;text-align:left;"></div></div></div></div>',
['<div id="ntkf-chat-header" style="background:#4297DF;border:1px solid #88BEED;float:none;border-top:none;border-bottom:1px solid #0067CC;width:auto;height:38px;margin:0;padding:0;color:#fff;display:block;"><div class="ntkf-chat-header-container" style="margin:0;padding:0;border:0;float:none;"><ul style="padding:0;margin:0;list-style:none;float:none;"><li class="ntkf-header-div" style="width:56px;height:56px;margin:0;padding:0;float:none;position:absolute;top:-20px;left:7px;color:#fff;background:#fff;border:1px solid #787878;">',
'<span style="width:54px;height:54px;margin:0;padding:0;border:0;float:none;background:#fff url('+this.url_chat_image+') no-repeat scroll 1px -359px;position:absolute;left:1px;top:1px;">','<img class="ntkf-header-icon" border="0" style="width:54px;height:54px;display:none;border:0;float:none;margin:0;padding:0;" /></span></li><li class="ntkf-header-name" style="width:auto;height:24px;margin:0;padding:0;float:none;position:absolute;top:7px;left:80px;color:#fff;font:bold 14px/160% Arial,SimSun;text-align:left;"></li><li class="ntkf-header-sign" style="width:auto;height:24px;margin:0;padding:0;float:none;position:absolute;top:7px;left:180px;color:#fff;font:normal 12px/24px Arial,SimSun;text-align:left;overflow:hidden;"></li>',
'<li class="ntkf-chat-close" title="'+i.chat_close_text+'" style="width:14px;height:14px;margin:0;padding:0;position:absolute;top:12px;right:10px;color:#fff;display:none;cursor:pointer;background:url('+this.url_chat_image+') no-repeat scroll 2px -218px;font:10px/10px Arial;text-align:center;"></li>','<li class="ntkf-chat-minimize" title="'+i.chat_minimize_text+'" style="width:14px;height:14px;margin:0;padding:0;position:absolute;top:12px;right:30px;color:#fff;display:none;cursor:pointer;background:url('+
this.url_chat_image+') no-repeat scroll 2px -198px;font:10px/10px Arial;"></li>','<li class="ntkf-chat-mjump" title="'+i.chat_mjump_text+'" style="width:14px;height:14px;margin:0;padding:0;position:absolute;top:12px;right:50px;color:#fff;display:none;cursor:pointer;background:url('+this.url_chat_image+') no-repeat scroll 2px -198px;font:10px/10px Arial;"></li>','<li style="height:0px;width:0px;line-height:0px;clear:both;margin:0;padding:0;"></li></ul></div></div>'].join("")],a=['<div class="ntkf-chat-container" style="margin:0 auto;padding:0;border:0;float:none;font:normal 12px/160% Arial,SimSun;width:100%;height:auto;z-index:-2;">'],
b.B.MOBILE?a.push(e[0]):a.push(e[1]),a.push('<div id="ntkf_chat_container" style="margin:0;padding:0;border:0;">','<div id="ntkf_chat_toolbars" style="display:none;margin:0;padding:0;border:0;background:#f7f7f7;border-right:1px solid #ccc;float:left;width:'+(this.style.chatToolbar.width-1)+"px;height:"+(this.style.height-this.style.header.height)+'px;">','<div class="ntkf-chat-scrollup" style="margin:0;padding:0;border:0;float:none;border-bottom:1px solid #fafafa;background:#d7d7d7 url('+this.url_chat_image+
') no-repeat scroll 55px -486px;width:100%;height:14px;cursor:auto;"></div>','<div class="ntkf-chat-toolbars-area" style="margin:0;padding:0;border:0;float:none;width:100%;height:'+this.style.toolarea.height+'px;border-top:1px solid #f2f2f2;border-bottom:1px solid #f2f2f2;overflow:hidden;">','<ul style="list-style:none;margin:3px 0 0 0;padding:0;border:0;float:none;display:width:100%;height:auto;"><li style="list-style:none;margin:0;padding:0;border:0;float:none;width:100%;height:1px;visibility:hidden;"></li></ul>',
"</div>",'<div class="ntkf-chat-scrolldown" style="margin:0;padding:0;border:0;float:none;border-top:1px solid #fafafa;background:#d7d7d7 url('+this.url_chat_image+') no-repeat scroll 55px -497px;width:100%;height:14px;cursor:auto;"></div>',"</div>",'<div id="ntkf_chat_content" style="width:'+this.style.width+'px;margin:0;padding:0;border:0;float:right;">',"</div>"),a.push("</div>"),a.push("</div>"),this.element=f({id:this.id,style:this._getStyle()}).html(a.join("")),this.precreateHide&&this.element.hide(),
a='<span style="margin:0;padding:0;border:0;float:none;display:block;height:20px;left:2px;position:absolute;top:3px;width:20px;background:#fff;"><img class="ntkf-toolbar-icon" border="0" style="display:none;float:none;width:20px;height:20px;margin:0;padding:0;border:0;background:#fff;" /></span><span class="ntkf-toolbar-title" style="margin:0;padding:0;border:0;float:none;display:block;height:25px;left:25px;font:normal 12px/24px Arial,SimSun;position:absolute;color:#fff;top:0;width:auto;"></span>',
style="margin:0;padding:0;float:none;display:none;border:1px solid #ccc;background:#f7f7f7;font:12px/25px Arial,SimSun;color:#000;text-align:left;height:25px;width:183px;cursor:pointer;z-index:2147483647;",b.B.MOBILE||(this.toolbar=f({id:this.toolbarid,style:style}).html(a)),this.chatcontainer=f("#ntkf_chat_container"))},_bindEvent:function(){h.Log("NTKF.chatManage._bindEvent()");this.elementHeader=f("#ntkf-chat-header");this.toolarea=f("#ntkf_chat_toolbars .ntkf-chat-toolbars-area");var a=this,e=
function(){var c=b.$(document.body).rect();a.style=j.extend(a.style,{width:c.width,height:c.viewH-a.style.top,body:{width:c.width,height:c.viewH-a.style.top-a.style.header.height,history:{height:(c.viewH||c.height)-a.style.top-a.style.header.height-(b.B.MOBILE?52:98)},left:{width:c.width-(b.B.MOBILE?0:172)},right:{width:172}}});a.hash.each(function(b,c){c.style=j.extend(c.style,a.style);c.resizeDialog()});f("#ntkf_chat_windows,#ntkf_chat_content",a.element).css({width:a.style.width+"px",height:a.style.height+
"px"});f(".ntkf-chat-child-left",a.element).css({width:a.style.body.left.width+"px",height:a.style.body.height+"px"});f(".ntkf-chat-historyarea",a.element).css({height:a.style.body.history.height+"px"});b.B.MOBILE||(f(".ntkf-chat-child-right",a.element).css({height:a.style.body.height+"px"}),f("iframe.ntkf-chat-iteminfo,div.ntkf-chat-faqlist,div.ntkf-chat-aboutus",a.element).css({height:a.style.body.height-31+"px"}),f("iframe.ntkf-chat-iteminfo",a.element).attr({height:a.style.body.height-31}),f(".ntkf-chat-face",
a.element).css("top",a.style.body.history.height-99+"px"))};this.btnMinimize=f(".ntkf-chat-minimize").bind("mousedown",function(a){b.E.fixEvent(a).stopPropagation()});this.btnClose=f(".ntkf-chat-close").bind("mousedown",function(a){b.E.fixEvent(a).stopPropagation()}).hover(function(c,d){b.chat_inpage?f(d).css("background","#fff url("+a.url_chat_image+") no-repeat scroll -13px -218px"):f(d).gradient("top","#d4d4d4","#ffffff")},function(c,d){!b.chat_inpage&&!b.B.MOBILE?f(d).gradient("top",a.curChatWindow?
a.curChatWindow.skin.gradient0:"#b6daf8",a.curChatWindow?a.curChatWindow.skin.gradient1:"#95c7f1"):b.B.MOBILE?f(d).gradient("top","#A0E0FC","#4FB5E5"):f(d).css("background","transparent url("+a.url_chat_image+") no-repeat scroll 2px -218px")});b.chat_inpage?(this.btnClose.bind("click",function(c){b.E.fixEvent(c).stopPropagation();a.close()}).css("display","block"),this.btnMinimize.hover(function(b,d){f(d).css("background","#fff url("+a.url_chat_image+") no-repeat scroll -13px -198px")},function(b,
d){f(d).css("background","transparent url("+a.url_chat_image+") no-repeat scroll 2px -198px")}).bind("click",function(c){b.E.fixEvent(c).stopPropagation();a.minimize()}).css("display","block"),f(".ntkf-chat-scrollup",this.element).bind("mouseover",function(b,d){a.disableUp||f(d).css({"background-color":"#c5c5c5"})}).bind("mouseout",function(b,d){a.disableUp||f(d).css({"background-color":"#d7d7d7"})}).bind("click",function(){a.disableUp||(a.style.toolarea.scrollHeight=a.toolarea.scrollHeight(),a.style.toolarea.top=
Math.min(a.style.toolarea.scrollHeight-a.style.toolarea.height,Math.max(0,a.style.toolarea.top-a.style.toolbar.height-5)),h.Log("scrollTop:"+a.style.toolarea.top),a.toolarea.scrollTop(a.style.toolarea.top),a._verifyScroll())}),f(".ntkf-chat-scrolldown",this.element).bind("mouseover",function(b,d){!a.disableDown&&-1==d.className.indexOf("flash")&&f(d).css({"background-color":"#c5c5c5"})}).bind("mouseout",function(b,d){!a.disableDown&&-1==d.className.indexOf("flash")&&f(d).css({"background-color":"#d7d7d7"})}).bind("click",
function(){a.disableDown||(a.style.toolarea.scrollHeight=a.toolarea.scrollHeight(),a.style.toolarea.top=Math.min(a.style.toolarea.scrollHeight-a.style.toolarea.height,Math.max(0,a.style.toolarea.top+a.style.toolbar.height+5)),h.Log("scrollTop:"+a.style.toolarea.top),a.toolarea.scrollTop(a.style.toolarea.top),a._verifyScroll())}),f(this.toolbar).bind("click",function(){a.maximize()}),this.scrollChat=new b.lockPosition(this.element.first(),{debug:!1,width:this.style.width,height:this.style.height,left:this.style.left,
top:this.style.top,drag:!0,handler:this.elementHeader.first(),origin:!1,fixed:b.globalConfig.fixed||!0,jsScroll:b.globalConfig.jsScroll||!1,onChange:function(b){a.style.left=a.style.chat.left=b.left;a.style.top=a.style.chat.top=b.top}}),b.E.addEvent(w,"beforeunload",function(){var c;c=a.curChatWindow;!a.inited||!c||!c.connected||!c.sendNum||1==c.config.disable_sessioncarry?b.Cookie.del("NTKF_T2D_sessionCarry"):(c=j.extend({settingid:c.settingid,id:c.dest.id,sid:c.dest.sid,htmlsid:c.htmlsid,single:c.single}),
b.Cookie.set("NTKF_T2D_sessionCarry",r.toJSONString(c),18E5))})):(e(),b.E.addEvent(w,"resize",e),b.E.addEvent(w,"beforeunload",function(c){a.curChatWindow.close();if(a.curChatWindow&&1==a.curChatWindow.config.enableevaluation&&!a.curChatWindow.submitRating&&a.curChatWindow.sendNum>=a.curChatWindow.sendNumEnable){if(n.CHROME)return i.news_before_evaluation;b.E.fixEvent(c).returnValue=i.news_before_evaluation}else setTimeout(function(){},500)}),this.btnClose.css({width:"auto",height:"30px",top:"4px",
color:"#000",background:"none",padding:"0 5px",font:"normal 12px/30px Microsoft YaHei,Arial,SimSun"}).insert(i.chat_stop_text).css("display","block"),this.btnClose.get(0)&&(this.btnClose.get(0).onclick=function(c){b.E.fixEvent(c).stopPropagation();a.close()}))},_verifyScroll:function(){var a=this.toolarea.scrollHeight()-this.style.toolarea.height,b=this.toolarea.scrollTop();0<b?(this.disableUp=!1,f(".ntkf-chat-scrollup",this.element).removeClass("disable").css({opacity:1,cursor:"pointer"})):(this.disableUp=
!0,f(".ntkf-chat-scrollup",this.element).addClass("disable").removeClass("flash").css({opacity:0.4,cursor:"auto","background-color":"#D7D7D7"}));b<a?(this.disableDown=!1,f(".ntkf-chat-scrolldown",this.element).removeClass("disable").css({opacity:1,cursor:"pointer"})):(this.disableDown=!0,f(".ntkf-chat-scrolldown",this.element).addClass("disable").removeClass("flash").css({opacity:0.4,cursor:"auto","background-color":"#D7D7D7"}))},_loadDefaultConfig:function(a){h.Log("NTKF.chatManage._loadDefaultConfig()");
var e=this,c;b.defaultConfig?a.call(e):(c=b.settingid.substr(0,b.settingid.lastIndexOf("_"))+"_"+b.settingid+".js?version="+b.version+"",x.load(b.url_service+"config/"+c,function(c){"complete"!=c.status||"undefined"==typeof b.CONFIG?h.Log("config file failed to load",3):(b.defaultConfig=j.extend(b.defaultConfig,{settingid:b.settingid},b.CONFIG),a.call(e))}))},_getStyle:function(a){var e={left:0,top:0,right:0,bottom:0},c,d=this.position,g=b.bodyOffset,f=["box-sizing:content-box;background:#fff;border:1px solid #999;font:normal normal normal 12px/24px Arial,SimSun;margin:0;padding:0;cursor:auto;z-index:1000000;display:block;overflow:visible;"];
b.chat_inpage?(f.push("width:"+this.style.width+"px;height:"+this.style.height+"px;"),d.rightline&&d.width?(e.right=(g.width-d.width)/2,b.isDefined(d.right)&&b.isDefined(d.bottom)&&(e.right=Math.max(0,e.right+d.right),e.bottom=Math.max(0,e.bottom+d.bottom))):this.position.element.length?(c=this.position.element.rect(),b.isDefined(d.left)&&b.isDefined(d.top)?(e.right=Math.max(0,g.width-c.left+d.left),e.bottom=Math.max(0,g.viewH-c.top+d.top)):b.isDefined(d.right)&&b.isDefined(d.bottom)&&(e.right=Math.max(0,
g.width-c.width-c.left-d.right),e.bottom=Math.max(0,g.viewH-c.height-c.top-d.bottom))):d.position&&""!=d.position?("left-top"==d.position?(e.right=Math.max(0,g.width-this.style.width),e.bottom=Math.max(0,g.viewH-this.style.height)):"center-top"==d.position?(e.right=Math.max(0,g.width-this.style.width)/2,e.bottom=Math.max(0,g.viewH-this.style.height)):"right-top"==d.position?(e.right=0,e.bottom=Math.max(0,g.viewH-this.style.height)):"left-center"==d.position?(e.right=Math.max(0,g.width-this.style.width),
e.bottom=Math.max(0,g.viewH-this.style.height)/2):"center-center"==d.position?(e.right=Math.max(0,g.width-this.style.width)/2,e.bottom=Math.max(0,g.viewH-this.style.height)/2):"right-center"==d.position?(e.right=0,e.bottom=Math.max(0,g.viewH-this.style.height)/2):("left-bottom"==d.position?e.right=Math.max(0,g.width-this.style.width):"center-bottom"==d.position?e.rigth=Math.max(0,g.width-this.style.width)/2:e.right=0,e.bottom=0),e.right+=d.right||0,e.bottom+=d.bottom||0):this.position.id||(b.isDefined(d.left)&&
b.isDefined(d.top)?(e.right=g.width-this.style.width-d.left,e.bottom=g.viewH-this.style.height-d.top):b.isDefined(d.right)&&b.isDefined(d.bottom)&&(e.right=d.right,e.bottom=d.bottom)),e.left=g.width-e.right-this.style.width-this.style.borderWidth,e.top=g.viewH-e.bottom-this.style.height-this.style.borderWidth,n.IE?f.push("position:absolute;left:"+(g.left+e.left)+"px;top:"+(g.viewY+e.top)+"px;"):f.push("position:fixed;right:"+e.right+"px;bottom:"+e.bottom+"px;")):(c=b.B.MOBILE?"static":n.IE?"absolute":
"fixed",e.left=0,e.top=b.B.MOBILE?0:19,this.style.width=g.width-e.left,this.style.height=g.viewH-e.top,f.push("width:"+this.style.width+"px;height:"+this.style.height+"px;position:"+c+";left:"+e.left+"px;top:"+e.top+"px;"));this.style.left=e.left;this.style.top=e.top;return a?e:f.join("")},_calculateColor:function(a){var e=b.Color.toHSL(this.baseColor),a=b.Color.toHSL(a);return b.J.toJSONString({h:parseFloat(e.h)-parseFloat(a.h),s:parseFloat(e.s)-parseFloat(a.s),l:parseFloat(e.l)-parseFloat(a.l)}).replace(/\"/ig,
"")}}}),b.extend({invite:{element:null,parent:null,width:206,height:112,inviteid:"",baseColor:"#4297e0",dest:null,settingid:"",showTips:function(a,e,c,d,g){this.config=b.defaultConfig;this.settingid=g||this.config.settingid;this.dest=j.extend({},this.dest,{id:a||"",sid:c||""});this.inviteid=d?d:"";h.Log("NTKF.invite.showTips()");switch(this.config.message_skin){case "chat/7":case "chat/8":case "chat/9":case "chat/1":this.baseColor="#4297e0";break;case "chat/2":case "chat/3":this.baseColor="#575757";
break;case "chat/4":this.baseColor="#f25488";break;case "chat/5":this.baseColor="#52ab52";break;case "chat/6":this.baseColor="#9bc942";break;default:this.baseColor=this.config.message_skin}this.parent=/(#|\.|\s)\w+/ig.test(this.config.position.entryid)?f(this.config.position.entryid):f("#"+this.config.position.entryid);this._create();setTimeout(function(){f(".ntkf-invite-tips-body").html(e)},50);return!0},hide:function(){b.invite.element&&(b.invite.element.hide(!0,!0),delete b.invite.element)},refuseInvite:function(a,
e){var c;try{b.PRESENCE&&b.PRESENCE.refuseInvite(a,e)}catch(d){}c=b.url_mcenter+"statistic.php?"+j.toURI({m:"Count",a:"collection",type:"invite",siteid:b.siteid,sid:self.inviteid,kfid:a,guestid:b.user.id,action:1,time:b.createTimeID(),t:"js"});x.load(c+"#rnd")},_create:function(){if(!this.element||!this.element.first()){var a=this,e=b.bodyOffset,c,d=0;c=0;var g=j.extend({left:0,top:0,right:0,bottom:0},b.defaultConfig.position.tip),h="margin:0;padding:0;border:0;font:normal 12px/160% Arial,SimSun;cursor:pointer;z-index:2147483648;width:"+
this.width+"px;height:"+this.height+"px;",p=['<div style="margin:0;padding:10px;border:0;background:url('+b.imagesResources.url_image+'/background_tips.gif) no-repeat 0 0;color:#333333;font:normal 12px/160% Arial,SimSun;text-align:left;height:92px;width:186px;z-index:99999;">','<div class="ntkf-invite-tips-body" style="margin:0;padding:0;border:0;float:left;font:normal 12px/160% Arial,SimSun;color:#333;height:60px;overflow:hidden;text-align:left;white-space:normal;width:156px;word-break:break-all;"></div>',
'<div class="ntkf-invite-tips-close" style="background:url('+b.imagesResources.url_chat_image+') no-repeat scroll 1px -180px;margin:5px;padding:0;border:0;cursor:pointer;font:normal 1px/1px Arial;height:12px;left:166px;position:absolute;top:4px;width:12px;"></div>','<div class="ntkf-invite-tips-button" style="background:'+this.baseColor+';margin:0;padding:0;border:0;color:#FFFFFF;cursor:pointer;height:24px;left:105px;font:normal 12px/24px Arial,SimSun;position:absolute;text-align:center;top:78px;width:69px;"></div>',
"</div>"].join("");this.parent.length?(c=this.parent.rect(),d=Math.max(0,e.width-c.left-c.width/2-this.width/2+g.left),c=Math.max(0,e.viewH-c.top+g.top)):(d=Math.max(0,g.right),c=Math.max(0,g.bottom));n.IE?(d=e.left+e.width-d-this.width,e=e.viewY+e.viewH-c-this.height,h+="position:absolute;left:"+d+"px;top:"+e+"px;"):h+="position:fixed;right:"+d+"px;bottom:"+c+"px;";this.element=f({id:"ntkf_invite_container",style:h}).html(p);f(".ntkf-invite-tips-button",this.element).html(i[this.sessionID||this.inviteid?
"button_reply":"button_consult"]);this.scrollObject=new b.lockPosition(this.element.first(),{fixed:!0});f("div.ntkf-invite-tips-close",this.element).bind("click",function(){a.refuseInvite(a.dest.id,0);a.hide()});f("div.ntkf-invite-tips-button, div.ntkf-invite-tips-body").bind("click",function(){a.openChatWindow()})}},openChatWindow:function(){b.globalConfig.chattype=4;this.hide();h.Log("newwindow:"+b.globalConfig.newwindow);h.Log("MOBILE:"+b.B.MOBILE);b.globalConfig.newwindow||b.B.MOBILE?(h.Log("NTKF.t2d.openChatWindow()"),
b.t2d.openChatWindow(this.dest.id,"",this.settingid)):(h.Log("NTKF.chatManage.open()"),b.chatManage.open(this.settingid,"",this.dest.id,{single:-1}))}}}),b.extend({queueNum:0,fIM_tchatFlashReady:function(a,e,c){var d=b.chatManage.get(c);h.Log('NTKF.fIM_tchatFlashReady("'+a+'", "'+e+'", "'+c+'")');clearTimeout(d.forFirefoxTimeID);d.connect_status="READY";d.forFirefoxTimeID=null;d.setUser({id:a});b.user.id=a||b.user.id;b.globalConfig.machineid=e||b.globalConfig.machineid;"zh_cn"!==i.language.toLowerCase()&&
d.Flash.setTextStyle&&(h.Log(d.settingid+":chat.Flash.setTextStyle"),d.Flash.setTextStyle(r.toJSONString({fontsize:20})));setTimeout(function(){d.callStat("4")},0);return!0},fIM_ConnectResult:function(a,e,c,d){var g,f=b.chatManage.get(d),d=d||f.config.settingid,c=p.hexToDec(c);h.Log("NTKF.fIM_ConnectResult("+a+", "+e+', "'+c+'", "'+d+'")');if(f)if(f.connected&&5===a)f.connect_status="CLOSECHAT";else{f.connected&&4===a&&f.disconnectTchat();e&&(e="string"==typeof e?b.J.parseJSON(e):e,f.setUser({id:e.myuid||
"",name:e.myuname||"",signature:e.signature||"",logo:p.protocolFilter(e.mylogo||""),sid:e.sessionid}),f.JetLag=b.createTimeID()-e.timesample);switch(a){case 1:f.clear();f.enableButton(!0);f.connect_status="COMPLETE";h.Log("connect "+f.dest.name+" complete",1);f.showSystemMessage({msg:b.utils.handleLinks(i.news_connect_complete,{destname:f.dest.name}),type:12,selectorWaitRemove:"ntkf_connect_complete_id",selectorRemove:"ntkf_disconnect_id,ntkf_connect_complete_id",mobile:b.B.MOBILE});h.Log("clear timeout 60 s");
clearTimeout(f.connectTime);f.connectTime=null;g=0;f.isreconnect?(f.send(),f.isreconnect=!1):(h.Log("count: "+f.waitSendMessage.count(),1),f.waitSendMessage.each(function(a,b){setTimeout(function(){h.Log("system: "+r.toJSONString(b),1);f.send(b)},g);g+=600}));break;case 0:case 2:if(f.connected){if(f.show_disconnect_message)return;f.show_disconnect_message=!0;f.showSystemMessage({msg:b.utils.handleLinks(i.news_interrupted,{settingid:d}),type:9,disable:0,selectorWaitRemove:"ntkf_disconnect_id"})}else{f.connect_status=
"FAILURE";return}}return!0}},fIM_requestEvaluate:function(a,e,c){h.Log('NTKF.fIM_requestEvaluate("'+r.toJSONString(arguments)+'")',1);var d=b.chatManage.get(c),c=c||d.config.settingid;d.showSubmitEvaluation();return!0},fIM_notifyUserInputing:function(a,e){var c=b.chatManage.get(e);setTimeout(function(){c&&c.showInputState&&c.showInputState(a)},0);return!0},fIM_getSessionCustomerServiceInfo:function(a,e){var c,d=b.chatManage.get(e);if(d){d.queryCustomerService="COMPLETE";if("string"==typeof a){h.Log("NTKF.fIM_getSessionCustomerServiceInfo('"+
a+"', \""+e+'")',1);a=a.replace("\r","").replace("\n","").replace("\r\n","");try{c=b.J.parseJSON(a)}catch(g){}}else h.Log("NTKF.fIM_getSessionCustomerServiceInfo('"+b.J.toJSONString(a)+"', \""+e+'")',1),c=a;if(!a||c.error||3!=c.status&&(!c.userid||!c.externalname&&!c.nickname))d.callStat("13"),d.showSystemMessage({msg:b.utils.handleLinks(i.news_interrupted,{settingid:e}),type:9,disable:1}),h.Log("Obtain customer service information breathless converges failure.",4);else{var l=j.extend({id:c.userid||
"",name:c.externalname||c.nickname||"",signature:c.signature||"",logo:p.protocolFilter(c.usericon||""),sid:c.sessionid||"",status:c.status||0});if(3!=c.status&&(!l.id||!l.name)){d.showSystemMessage({msg:b.utils.handleLinks(i.news_interrupted,{settingid:e}),type:9,disable:1});return}0===c.status?(d.callStat("12"),d.setDest(l),clearInterval(d.waitTimer),d.startWaiting=!1,j.extend(b.globalConfig,{destid:l.id,destsid:l.sid}),d.showSystemMessage({msg:b.utils.handleLinks(i.news_not_online,{destname:l.name,
settingid:e}),type:9,disable:1}),d.switchUI(b.globalConfig.type||1,0)):3===c.status?(d.queueNum!=c.num&&(f("."+d.waitElementClass,d.element).remove(),f(".ntkf_chat_wait_time",d.element).remove(),d.queueNum=c.num),!0!=d.startWaiting&&(d.startWaiting=!0,d.callStat("11"),d.waitTime=0,d.waitTimer=setInterval(function(){0==d.waitTime%3&&d.getCustomerServiceInfo(d.destid,d.single,!0);d.waitTime++;f(".ntkf_chat_wait_time",d.element).html(p.secondsToMinutes(d.waitTime))},1E3)),f(".ntkf_chat_wait_time",d.element).first()||
(d.setDest(l),d.queueNum=c.num||0,d.enableButton(!1),c='<span class="ntkf_chat_wait_time" style="margin:0;padding:0;border:0;font:normal 12px/160% Arial,SimSun;color:#333;">'+p.secondsToMinutes(d.waitTime)+"</span>",d.waitElementClass="wait_id_"+b.createTimeID(),1===d.config.disable_message?d.showSystemMessage({msg:b.utils.handleLinks(i.news_queue_no_message,{settingid:e,count:d.queueNum.toString(),time:c,br:" "}),type:11,selectorWaitRemove:d.waitElementClass}):d.showSystemMessage({msg:b.utils.handleLinks(i.news_queue,
{settingid:e,count:d.queueNum.toString(),time:c,br:" "}),type:11,selectorWaitRemove:d.waitElementClass}))):(d.callStat("10"),d.setDest(l),clearInterval(d.waitTimer),d.startWaiting=!1,f("."+d.waitElementClass,d.element).remove(),setTimeout(function(){h.Log("connect user "+l.name+"...",1);1==d.config.submitinfo&&"1"!=b.CACHE.get("submituserinfo")&&!d.carry?d.showSubmitUserInfo(function(){d.createConnect()}):d.createConnect()},0))}return!0}},fIM_onGetUserInfo:function(a,e){var c=a.replace("\r","").replace("\n",
""),d=b.chatManage.get(e);h.Log("NTKF.fIM_onGetUserInfo('"+a+"', \""+e+'")');try{c=b.J.parseJSON(a)}catch(f){h.Log(f.message,3)}d.dest.id!=c.userid&&1!=c.status?h.Log("Switch to is not online customer service does not update the customer information",2):(d.setDest({id:c.userid||d.dest.id,name:c.externalname||c.nickname||d.dest.name,signature:c.signature||d.dest.signature,logo:p.protocolFilter(c.logo||d.dest.logo),status:c.status}),/^(0|2)$/.test(c.status)?d.showSystemMessage({msg:b.utils.handleLinks(i.news_offline,
{settingid:e,destname:d.dest.name}),type:9,disable:1}):4==c.status?d.showSystemMessage({msg:b.utils.handleLinks(i.news_leave,{settingid:e,destname:d.dest.name}),type:9,disable:1,selectorWaitRemove:"ntkf_leave_system_id",selectorRemove:"ntkf_leave_system_id"}):d.showSystemMessage({type:5,disable:0,selectorRemove:"ntkf_leave_system_id"}))},fIM_receiveCustomerServiceInfo:function(a,b){h.Log('NTKF.fIM_receiveCustomerServiceInfo("'+a+'", "'+b+'")')},fIM_onGetUserStatus:function(a,b){h.Log("NTKF.fIM_onGetUserStatus("+
a+', "'+b+'")');return!0},fIM_onNotifySessionSence:function(a,e){h.Log("NTKF.fIM_onNotifySessionSence("+a+', "'+e+'")');setTimeout(function(){var c,d=b.chatManage.get(e);try{c=b.J.parseJSON(a)}catch(f){}0<c.score?(d.submitRating=!0,d.enableButton(!1,"ntkf-icon-evaluation")):d.sendNum>=d.sendNumEnable&&!d.submitRating&&d.enableButton(!0,"ntkf-icon-evaluation")},0);return!0},fIM_notifyUserNumbers:function(a,e){var c=b.chatManage.get(e),d=function(){c.connected?1<=a&&c.callStat("21"):setTimeout(d,50)};
b.globalConfig.userNumber!=a&&(b.globalConfig.userNumber=a,setTimeout(d,50))},fIM_receiveMessage:function(a,e){var c=b.chatManage.get(e);"string"==typeof a?setTimeout(function(){var d;try{d=b.J.parseJSON(a)}catch(e){h.Log(e,3)}d&&c.receive(d)},10):a&&c.receive(a)},fIM_onGetFlashServer:function(){},fIM_setTChatGoServer:function(a,e){var c=b.chatManage.get(e),d=/cid=(\-?\d+)/gi;a&&(d=d.exec(a),c.chatFlashGoUrl=p.protocolFilter(a),c.chatgourl=p.protocolFilter(a.substr(0,a.indexOf("?"))),c.clientid=d&&
2==d.length?d[1]:"")},fIM_updateUserNumber:function(){}}),b.extend({fIM_uploadFlashReady:function(a,e,c){var d,f;setTimeout(function(){d="uploadfile"==e?"Flash_File":"Flash_Image";(f=b.chatManage.get(c))&&f[d].setUploadServer&&f[d].setUploadServer(f.config.service.fileServer)},0);return!0},fIM_uploadMouseOver:function(){},fIM_uploadMouseOut:function(){},fIM_startSendFile:function(a,e,c,d){var a=b.chatManage.get(d),f=p.hexToDec(c||"").replace(/.*?(\u201c|\\u201c)/ig,"").replace(/(\u201d|\\u201d).*?$/ig,
"");f&&(c=b.utils.handleLinks(i.news_start_trans,{settingid:d,type:"uploadfile"==e?i.button_file:i.button_image,file:f,action:e}));a.showMessage({type:11,selectorWaitRemove:e+"_id_replace_upload",msg:c});return!0},fIM_receiveUploadSuccess:function(a,e,c,d){setTimeout(function(){var a=b.chatManage.get(d),f;f="string"==typeof c?b.J.parseJSON(c):c;f.msg=i.news_trans_complete;a.send(j.extend(p.protocolFilter(f),{selectorRemove:e+"_id_replace_upload",userid:a.user.id}))},0)},fIM_receiveUploadFailure:function(a,
e,c,d){h.Log("fIM_receiveUploadFailure("+r.toJSONString(arguments)+")");b.chatManage.get(d).showMessage({type:9,msg:p.hexToDec(c)})},fIM_receiveUploadProgress:function(){return!0}}),b.extend({windowOpen:function(a,e){b.E.fixEvent(a).stopPropagation();window.open(e)},im_sendMessage:function(a,e){var c=b.chatManage.get(e);if(!c||!c.connected)return!1;c.send({type:1,msg:a})},createNewUserID:function(){var a=b.globalConfig.machineid||b.Cookie.get("NTKF_T2D_CLIENTID");a||(a="guest"+[b.randomChar(8),b.randomChar(4),
b.randomChar(4),b.randomChar(4),b.randomChar(12)].join("-"),b.Cookie.set("NTKF_T2D_CLIENTID",a,63072E6));b.globalConfig.machineid=a;return a.substr(0,21)},shortId2LongUserID:function(a,e){var c=b.siteid,d=c+"_ISME9754_T2D_",f=c+"_ISME9754_GT2D_",c=c+"_ISME9754_";if(e)return a?-1<a.indexOf(f)||-1<a.indexOf(d)?a:d+a:"";a||(a=this.createNewUserID());b.user.shortID=-1<a.indexOf(c)?a.substr(c.length,64-c.length):a.substr(0,64-c.length);return c+b.user.shortID},scriptChatInitialize:function(){clearTimeout(b.preLoadedTimeID);
if(!b.globalConfig.chatLoaded){b.globalConfig.chatLoaded=!0;b.chatConnectType=!b.Flash.supportFlash()||b.B.MOBILE||"FLASH"!==b.chatConnectType?"COMET":"FLASH";h.Log("scriptChatInitialize, "+b.chatConnectType);b.url_resource=b.url_resource||b.url.substr(0,b.url.lastIndexOf("/"));if(!b.chat_inpage){b.url_source=b.params.ref;if(!b.url_source)try{b.url_source=y.referrer||w.opener&&!n.IE&&w.opener.location.href||""}catch(a){}if(!b.url_source)try{b.url_source=w.parent&&w.parent.location.href!=C.href?w.parent.location.href:
""}catch(e){}j.wget(b,b.params,["siteid","settingid"]);if(!b.settingid){h.Log("query param settingid is null",3);return}b.siteid||(b.siteid=b.settingid.split("_").slice(0,2).join("_"));b.url_resource=b.url_resource||b.url.substr(0,b.url.lastIndexOf("/"));b.globalConfig.machineid=b.params.machineid||"";b.user.id=this.shortId2LongUserID(b.params.uid||b.params.myuid,!1);b.user.name=b.params.uname||b.params.myuname||"";b.globalConfig.desid=this.shortId2LongUserID(b.params.destid||b.globalConfig.destid||
"",!0);b.globalConfig.destsid=b.params.sid||b.params.mysid||"";b.globalConfig.single=-1<b.globalConfig.desid.indexOf("GT2D")?0:1;b.globalConfig.erpparam=b.params.erpparam||"";b.globalConfig.lang=window.navigator.language||window.navigator.systemLanguage;b.user.name=p.cut(b.user.name,32);b.globalConfig.curCode=decodeURIComponent(b.params.ck||"");b.title=decodeURIComponent(b.params.title||"");j.wget(b.globalConfig,b.params,"userlevel itemid itemparam orderid orderprice type chattype chatvalue inviteid".split(" "));
b.params.proinfo&&(-1<b.params.proinfo.indexOf("{")?(b.globalConfig.proinfo=r.parseJSON(decodeURIComponent(b.params.proinfo)),b.globalConfig.itemid=b.globalConfig.proinfo.id):b.globalConfig.itemid=b.params.proinfo)}b.imagesResources=j.extend(b.imagesResources,{url_image:b.url_resource+"/images2.0",url_chat_image:b.url_resource+"/images2.0/chat_icon."+(n.IE6?"gif":"png"),url_mobile_image:b.url_resource+"/images2.0/mobile_icon.png"});b.imagesResources.resources.push(b.imagesResources.url_chat_image);
b.B.MOBILE&&b.imagesResources.resources.push(b.imagesResources.url_mobile_image);x.load(b.imagesResources.resources,function(a){if(b.isArray(a))for(var d=0;d<a.length;d++)"complete"!=a[d].status&&h.Log("Chat window icon failed to load",3);else"complete"!=a.status&&h.Log("Chat window icon failed to load",3)});b.globalConfig.waitSendMessage||(b.globalConfig.waitSendMessage=new E);b.chat_inpage||b.ready(function(){b.url_name||b.chatManage.open(b.settingid,"",b.globalConfig.desid,{single:b.globalConfig.single})});
b.globalConfig.waitSendMessage.add(b.createTimeID(1),{type:5,msg:{msgtype:2,parentpagetitle:b.title.substr(0,32),parentpageurl:b.url_source,userlevel:b.globalConfig.userlevel,sences:""}});b.globalConfig.waitSendMessage.add(b.createTimeID(1),{type:5,msg:{msgtype:7,param:b.globalConfig.erpparam+"|lang="+b.globalConfig.lang}});h.Log("system count:"+b.globalConfig.waitSendMessage.count(),1)}}}),b.scriptChatInitialize())})();
